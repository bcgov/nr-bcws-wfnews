import { capitalize } from './helpers';
import { isPlainObject } from './meta-reducers/utils';
import { createFeatureSelector, createSelector, } from './selector';
/**
 * @description
 * A function that accepts a feature name and a feature reducer, and creates
 * a feature selector and a selector for each feature state property.
 * This function also provides the ability to add extra selectors to
 * the feature object.
 *
 * @param featureConfig An object that contains a feature name and a feature
 * reducer as required, and extra selectors factory as an optional argument.
 * @returns An object that contains a feature name, a feature reducer,
 * a feature selector, a selector for each feature state property, and extra
 * selectors.
 *
 * @usageNotes
 *
 * ```ts
 * interface ProductsState {
 *   products: Product[];
 *   selectedId: string | null;
 * }
 *
 * const initialState: ProductsState = {
 *   products: [],
 *   selectedId: null,
 * };
 *
 * const productsFeature = createFeature({
 *   name: 'products',
 *   reducer: createReducer(
 *     initialState,
 *     on(ProductsApiActions.loadSuccess(state, { products }) => ({
 *       ...state,
 *       products,
 *     }),
 *   ),
 * });
 *
 * const {
 *   name,
 *   reducer,
 *   // feature selector
 *   selectProductsState, // type: MemoizedSelector<Record<string, any>, ProductsState>
 *   // feature state properties selectors
 *   selectProducts, // type: MemoizedSelector<Record<string, any>, Product[]>
 *   selectSelectedId, // type: MemoizedSelector<Record<string, any>, string | null>
 * } = productsFeature;
 * ```
 *
 * **Creating Feature with Extra Selectors**
 *
 * ```ts
 * type CallState = 'init' | 'loading' | 'loaded' | { error: string };
 *
 * interface State extends EntityState<Product> {
 *   callState: CallState;
 * }
 *
 * const adapter = createEntityAdapter<Product>();
 * const initialState: State = adapter.getInitialState({
 *   callState: 'init',
 * });
 *
 * export const productsFeature = createFeature({
 *   name: 'products',
 *   reducer: createReducer(initialState),
 *   extraSelectors: ({ selectProductsState, selectCallState }) => ({
 *     ...adapter.getSelectors(selectBooksState),
 *     ...getCallStateSelectors(selectCallState)
 *   }),
 * });
 *
 * const {
 *   name,
 *   reducer,
 *   // feature selector
 *   selectProductsState,
 *   // feature state properties selectors
 *   selectIds,
 *   selectEntities,
 *   selectCallState,
 *   // selectors returned by `adapter.getSelectors`
 *   selectAll,
 *   selectTotal,
 *   // selectors returned by `getCallStateSelectors`
 *   selectIsLoading,
 *   selectIsLoaded,
 *   selectError,
 * } = productsFeature;
 * ```
 */
export function createFeature(featureConfig) {
    const { name, reducer, extraSelectors: extraSelectorsFactory, } = featureConfig;
    const featureSelector = createFeatureSelector(name);
    const nestedSelectors = createNestedSelectors(featureSelector, reducer);
    const baseSelectors = {
        [`select${capitalize(name)}State`]: featureSelector,
        ...nestedSelectors,
    };
    const extraSelectors = extraSelectorsFactory
        ? extraSelectorsFactory(baseSelectors)
        : {};
    return {
        name,
        reducer,
        ...baseSelectors,
        ...extraSelectors,
    };
}
function createNestedSelectors(featureSelector, reducer) {
    const initialState = getInitialState(reducer);
    const nestedKeys = (isPlainObject(initialState) ? Object.keys(initialState) : []);
    return nestedKeys.reduce((nestedSelectors, nestedKey) => ({
        ...nestedSelectors,
        [`select${capitalize(nestedKey)}`]: createSelector(featureSelector, (parentState) => parentState?.[nestedKey]),
    }), {});
}
function getInitialState(reducer) {
    return reducer(undefined, { type: '@ngrx/feature/init' });
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmVhdHVyZV9jcmVhdG9yLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vbW9kdWxlcy9zdG9yZS9zcmMvZmVhdHVyZV9jcmVhdG9yLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxXQUFXLENBQUM7QUFFdkMsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLHVCQUF1QixDQUFDO0FBQ3RELE9BQU8sRUFDTCxxQkFBcUIsRUFDckIsY0FBYyxHQUVmLE1BQU0sWUFBWSxDQUFDO0FBbUdwQjs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7R0F5Rkc7QUFDSCxNQUFNLFVBQVUsYUFBYSxDQU0zQixhQU1DO0lBRUQsTUFBTSxFQUNKLElBQUksRUFDSixPQUFPLEVBQ1AsY0FBYyxFQUFFLHFCQUFxQixHQUN0QyxHQUFHLGFBQWEsQ0FBQztJQUVsQixNQUFNLGVBQWUsR0FBRyxxQkFBcUIsQ0FBZSxJQUFJLENBQUMsQ0FBQztJQUNsRSxNQUFNLGVBQWUsR0FBRyxxQkFBcUIsQ0FBQyxlQUFlLEVBQUUsT0FBTyxDQUFDLENBQUM7SUFDeEUsTUFBTSxhQUFhLEdBQUc7UUFDcEIsQ0FBQyxTQUFTLFVBQVUsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLEVBQUUsZUFBZTtRQUNuRCxHQUFHLGVBQWU7S0FDOEMsQ0FBQztJQUNuRSxNQUFNLGNBQWMsR0FBRyxxQkFBcUI7UUFDMUMsQ0FBQyxDQUFDLHFCQUFxQixDQUFDLGFBQWEsQ0FBQztRQUN0QyxDQUFDLENBQUMsRUFBRSxDQUFDO0lBRVAsT0FBTztRQUNMLElBQUk7UUFDSixPQUFPO1FBQ1AsR0FBRyxhQUFhO1FBQ2hCLEdBQUcsY0FBYztLQUMrQyxDQUFDO0FBQ3JFLENBQUM7QUFFRCxTQUFTLHFCQUFxQixDQUk1QixlQUF5RCxFQUN6RCxPQUFvQztJQUVwQyxNQUFNLFlBQVksR0FBRyxlQUFlLENBQUMsT0FBTyxDQUFDLENBQUM7SUFDOUMsTUFBTSxVQUFVLEdBQUcsQ0FDakIsYUFBYSxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQ3ZCLENBQUM7SUFFeEMsT0FBTyxVQUFVLENBQUMsTUFBTSxDQUN0QixDQUFDLGVBQWUsRUFBRSxTQUFTLEVBQUUsRUFBRSxDQUFDLENBQUM7UUFDL0IsR0FBRyxlQUFlO1FBQ2xCLENBQUMsU0FBUyxVQUFVLENBQUMsU0FBUyxDQUFDLEVBQUUsQ0FBQyxFQUFFLGNBQWMsQ0FDaEQsZUFBZSxFQUNmLENBQUMsV0FBVyxFQUFFLEVBQUUsQ0FBQyxXQUFXLEVBQUUsQ0FBQyxTQUFTLENBQUMsQ0FDMUM7S0FDRixDQUFDLEVBQ0YsRUFBNkMsQ0FDOUMsQ0FBQztBQUNKLENBQUM7QUFFRCxTQUFTLGVBQWUsQ0FDdEIsT0FBb0M7SUFFcEMsT0FBTyxPQUFPLENBQUMsU0FBUyxFQUFFLEVBQUUsSUFBSSxFQUFFLG9CQUFvQixFQUFFLENBQUMsQ0FBQztBQUM1RCxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgY2FwaXRhbGl6ZSB9IGZyb20gJy4vaGVscGVycyc7XG5pbXBvcnQgeyBBY3Rpb25SZWR1Y2VyLCBTZWxlY3RvciB9IGZyb20gJy4vbW9kZWxzJztcbmltcG9ydCB7IGlzUGxhaW5PYmplY3QgfSBmcm9tICcuL21ldGEtcmVkdWNlcnMvdXRpbHMnO1xuaW1wb3J0IHtcbiAgY3JlYXRlRmVhdHVyZVNlbGVjdG9yLFxuICBjcmVhdGVTZWxlY3RvcixcbiAgTWVtb2l6ZWRTZWxlY3Rvcixcbn0gZnJvbSAnLi9zZWxlY3Rvcic7XG5pbXBvcnQgeyBGZWF0dXJlU2VsZWN0b3IsIE5lc3RlZFNlbGVjdG9ycyB9IGZyb20gJy4vZmVhdHVyZV9jcmVhdG9yX21vZGVscyc7XG5cbmV4cG9ydCBpbnRlcmZhY2UgRmVhdHVyZUNvbmZpZzxGZWF0dXJlTmFtZSBleHRlbmRzIHN0cmluZywgRmVhdHVyZVN0YXRlPiB7XG4gIG5hbWU6IEZlYXR1cmVOYW1lO1xuICByZWR1Y2VyOiBBY3Rpb25SZWR1Y2VyPEZlYXR1cmVTdGF0ZT47XG59XG5cbnR5cGUgRmVhdHVyZTxcbiAgQXBwU3RhdGUgZXh0ZW5kcyBSZWNvcmQ8c3RyaW5nLCBhbnk+LFxuICBGZWF0dXJlTmFtZSBleHRlbmRzIGtleW9mIEFwcFN0YXRlICYgc3RyaW5nLFxuICBGZWF0dXJlU3RhdGUgZXh0ZW5kcyBBcHBTdGF0ZVtGZWF0dXJlTmFtZV1cbj4gPSBGZWF0dXJlQ29uZmlnPEZlYXR1cmVOYW1lLCBGZWF0dXJlU3RhdGU+ICZcbiAgQmFzZVNlbGVjdG9yczxBcHBTdGF0ZSwgRmVhdHVyZU5hbWUsIEZlYXR1cmVTdGF0ZT47XG5cbnR5cGUgRmVhdHVyZVdpdGhFeHRyYVNlbGVjdG9yczxcbiAgRmVhdHVyZU5hbWUgZXh0ZW5kcyBzdHJpbmcsXG4gIEZlYXR1cmVTdGF0ZSxcbiAgRXh0cmFTZWxlY3RvcnMgZXh0ZW5kcyBTZWxlY3RvcnNEaWN0aW9uYXJ5XG4+ID0gc3RyaW5nIGV4dGVuZHMga2V5b2YgRXh0cmFTZWxlY3RvcnNcbiAgPyBGZWF0dXJlPFJlY29yZDxzdHJpbmcsIGFueT4sIEZlYXR1cmVOYW1lLCBGZWF0dXJlU3RhdGU+XG4gIDogT21pdDxcbiAgICAgIEZlYXR1cmU8UmVjb3JkPHN0cmluZywgYW55PiwgRmVhdHVyZU5hbWUsIEZlYXR1cmVTdGF0ZT4sXG4gICAgICBrZXlvZiBFeHRyYVNlbGVjdG9yc1xuICAgID4gJlxuICAgICAgRXh0cmFTZWxlY3RvcnM7XG5cbnR5cGUgQmFzZVNlbGVjdG9yczxcbiAgQXBwU3RhdGUgZXh0ZW5kcyBSZWNvcmQ8c3RyaW5nLCBhbnk+LFxuICBGZWF0dXJlTmFtZSBleHRlbmRzIGtleW9mIEFwcFN0YXRlICYgc3RyaW5nLFxuICBGZWF0dXJlU3RhdGUgZXh0ZW5kcyBBcHBTdGF0ZVtGZWF0dXJlTmFtZV1cbj4gPSBGZWF0dXJlU2VsZWN0b3I8QXBwU3RhdGUsIEZlYXR1cmVOYW1lLCBGZWF0dXJlU3RhdGU+ICZcbiAgTmVzdGVkU2VsZWN0b3JzPEFwcFN0YXRlLCBGZWF0dXJlU3RhdGU+O1xuXG50eXBlIFNlbGVjdG9yc0RpY3Rpb25hcnkgPSBSZWNvcmQ8XG4gIHN0cmluZyxcbiAgfCBTZWxlY3RvcjxSZWNvcmQ8c3RyaW5nLCBhbnk+LCB1bmtub3duPlxuICB8ICgoLi4uYXJnczogYW55W10pID0+IFNlbGVjdG9yPFJlY29yZDxzdHJpbmcsIGFueT4sIHVua25vd24+KVxuPjtcblxudHlwZSBFeHRyYVNlbGVjdG9yc0ZhY3Rvcnk8XG4gIEZlYXR1cmVOYW1lIGV4dGVuZHMgc3RyaW5nLFxuICBGZWF0dXJlU3RhdGUsXG4gIEV4dHJhU2VsZWN0b3JzIGV4dGVuZHMgU2VsZWN0b3JzRGljdGlvbmFyeVxuPiA9IChcbiAgYmFzZVNlbGVjdG9yczogQmFzZVNlbGVjdG9yczxSZWNvcmQ8c3RyaW5nLCBhbnk+LCBGZWF0dXJlTmFtZSwgRmVhdHVyZVN0YXRlPlxuKSA9PiBFeHRyYVNlbGVjdG9ycztcblxudHlwZSBOb3RBbGxvd2VkRmVhdHVyZVN0YXRlQ2hlY2s8RmVhdHVyZVN0YXRlPiA9XG4gIEZlYXR1cmVTdGF0ZSBleHRlbmRzIFJlcXVpcmVkPEZlYXR1cmVTdGF0ZT5cbiAgICA/IHVua25vd25cbiAgICA6ICdvcHRpb25hbCBwcm9wZXJ0aWVzIGFyZSBub3QgYWxsb3dlZCBpbiB0aGUgZmVhdHVyZSBzdGF0ZSc7XG5cbi8qKlxuICogQ3JlYXRlcyBhIGZlYXR1cmUgb2JqZWN0IHdpdGggZXh0cmEgc2VsZWN0b3JzLlxuICpcbiAqIEBwYXJhbSBmZWF0dXJlQ29uZmlnIEFuIG9iamVjdCB0aGF0IGNvbnRhaW5zIGEgZmVhdHVyZSBuYW1lLCBhIGZlYXR1cmVcbiAqIHJlZHVjZXIsIGFuZCBleHRyYSBzZWxlY3RvcnMgZmFjdG9yeS5cbiAqIEByZXR1cm5zIEFuIG9iamVjdCB0aGF0IGNvbnRhaW5zIGEgZmVhdHVyZSBuYW1lLCBhIGZlYXR1cmUgcmVkdWNlcixcbiAqIGEgZmVhdHVyZSBzZWxlY3RvciwgYSBzZWxlY3RvciBmb3IgZWFjaCBmZWF0dXJlIHN0YXRlIHByb3BlcnR5LCBhbmRcbiAqIGV4dHJhIHNlbGVjdG9ycy5cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZUZlYXR1cmU8XG4gIEZlYXR1cmVOYW1lIGV4dGVuZHMgc3RyaW5nLFxuICBGZWF0dXJlU3RhdGUsXG4gIEV4dHJhU2VsZWN0b3JzIGV4dGVuZHMgU2VsZWN0b3JzRGljdGlvbmFyeVxuPihcbiAgZmVhdHVyZUNvbmZpZzogRmVhdHVyZUNvbmZpZzxGZWF0dXJlTmFtZSwgRmVhdHVyZVN0YXRlPiAmIHtcbiAgICBleHRyYVNlbGVjdG9yczogRXh0cmFTZWxlY3RvcnNGYWN0b3J5PFxuICAgICAgRmVhdHVyZU5hbWUsXG4gICAgICBGZWF0dXJlU3RhdGUsXG4gICAgICBFeHRyYVNlbGVjdG9yc1xuICAgID47XG4gIH0gJiBOb3RBbGxvd2VkRmVhdHVyZVN0YXRlQ2hlY2s8RmVhdHVyZVN0YXRlPlxuKTogRmVhdHVyZVdpdGhFeHRyYVNlbGVjdG9yczxGZWF0dXJlTmFtZSwgRmVhdHVyZVN0YXRlLCBFeHRyYVNlbGVjdG9ycz47XG4vKipcbiAqIENyZWF0ZXMgYSBmZWF0dXJlIG9iamVjdC5cbiAqXG4gKiBAcGFyYW0gZmVhdHVyZUNvbmZpZyBBbiBvYmplY3QgdGhhdCBjb250YWlucyBhIGZlYXR1cmUgbmFtZSBhbmQgYSBmZWF0dXJlXG4gKiByZWR1Y2VyLlxuICogQHJldHVybnMgQW4gb2JqZWN0IHRoYXQgY29udGFpbnMgYSBmZWF0dXJlIG5hbWUsIGEgZmVhdHVyZSByZWR1Y2VyLFxuICogYSBmZWF0dXJlIHNlbGVjdG9yLCBhbmQgYSBzZWxlY3RvciBmb3IgZWFjaCBmZWF0dXJlIHN0YXRlIHByb3BlcnR5LlxuICovXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlRmVhdHVyZTxGZWF0dXJlTmFtZSBleHRlbmRzIHN0cmluZywgRmVhdHVyZVN0YXRlPihcbiAgZmVhdHVyZUNvbmZpZzogRmVhdHVyZUNvbmZpZzxGZWF0dXJlTmFtZSwgRmVhdHVyZVN0YXRlPiAmXG4gICAgTm90QWxsb3dlZEZlYXR1cmVTdGF0ZUNoZWNrPEZlYXR1cmVTdGF0ZT5cbik6IEZlYXR1cmU8UmVjb3JkPHN0cmluZywgYW55PiwgRmVhdHVyZU5hbWUsIEZlYXR1cmVTdGF0ZT47XG4vKipcbiAqIEBkZXByZWNhdGVkIFVzZSB0aGUgYGNyZWF0ZUZlYXR1cmVgIHNpZ25hdHVyZSB3aXRob3V0IHJvb3Qgc3RhdGUgaW5zdGVhZC5cbiAqIEZvciBtb3JlIGluZm8gc2VlOiBodHRwczovL2dpdGh1Yi5jb20vbmdyeC9wbGF0Zm9ybS9pc3N1ZXMvMzczN1xuICovXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlRmVhdHVyZTxcbiAgQXBwU3RhdGUgZXh0ZW5kcyBSZWNvcmQ8c3RyaW5nLCBhbnk+LFxuICBGZWF0dXJlTmFtZSBleHRlbmRzIGtleW9mIEFwcFN0YXRlICYgc3RyaW5nID0ga2V5b2YgQXBwU3RhdGUgJiBzdHJpbmcsXG4gIEZlYXR1cmVTdGF0ZSBleHRlbmRzIEFwcFN0YXRlW0ZlYXR1cmVOYW1lXSA9IEFwcFN0YXRlW0ZlYXR1cmVOYW1lXVxuPihcbiAgZmVhdHVyZUNvbmZpZzogRmVhdHVyZUNvbmZpZzxGZWF0dXJlTmFtZSwgRmVhdHVyZVN0YXRlPiAmXG4gICAgTm90QWxsb3dlZEZlYXR1cmVTdGF0ZUNoZWNrPEZlYXR1cmVTdGF0ZT5cbik6IEZlYXR1cmU8QXBwU3RhdGUsIEZlYXR1cmVOYW1lLCBGZWF0dXJlU3RhdGU+O1xuLyoqXG4gKiBAZGVzY3JpcHRpb25cbiAqIEEgZnVuY3Rpb24gdGhhdCBhY2NlcHRzIGEgZmVhdHVyZSBuYW1lIGFuZCBhIGZlYXR1cmUgcmVkdWNlciwgYW5kIGNyZWF0ZXNcbiAqIGEgZmVhdHVyZSBzZWxlY3RvciBhbmQgYSBzZWxlY3RvciBmb3IgZWFjaCBmZWF0dXJlIHN0YXRlIHByb3BlcnR5LlxuICogVGhpcyBmdW5jdGlvbiBhbHNvIHByb3ZpZGVzIHRoZSBhYmlsaXR5IHRvIGFkZCBleHRyYSBzZWxlY3RvcnMgdG9cbiAqIHRoZSBmZWF0dXJlIG9iamVjdC5cbiAqXG4gKiBAcGFyYW0gZmVhdHVyZUNvbmZpZyBBbiBvYmplY3QgdGhhdCBjb250YWlucyBhIGZlYXR1cmUgbmFtZSBhbmQgYSBmZWF0dXJlXG4gKiByZWR1Y2VyIGFzIHJlcXVpcmVkLCBhbmQgZXh0cmEgc2VsZWN0b3JzIGZhY3RvcnkgYXMgYW4gb3B0aW9uYWwgYXJndW1lbnQuXG4gKiBAcmV0dXJucyBBbiBvYmplY3QgdGhhdCBjb250YWlucyBhIGZlYXR1cmUgbmFtZSwgYSBmZWF0dXJlIHJlZHVjZXIsXG4gKiBhIGZlYXR1cmUgc2VsZWN0b3IsIGEgc2VsZWN0b3IgZm9yIGVhY2ggZmVhdHVyZSBzdGF0ZSBwcm9wZXJ0eSwgYW5kIGV4dHJhXG4gKiBzZWxlY3RvcnMuXG4gKlxuICogQHVzYWdlTm90ZXNcbiAqXG4gKiBgYGB0c1xuICogaW50ZXJmYWNlIFByb2R1Y3RzU3RhdGUge1xuICogICBwcm9kdWN0czogUHJvZHVjdFtdO1xuICogICBzZWxlY3RlZElkOiBzdHJpbmcgfCBudWxsO1xuICogfVxuICpcbiAqIGNvbnN0IGluaXRpYWxTdGF0ZTogUHJvZHVjdHNTdGF0ZSA9IHtcbiAqICAgcHJvZHVjdHM6IFtdLFxuICogICBzZWxlY3RlZElkOiBudWxsLFxuICogfTtcbiAqXG4gKiBjb25zdCBwcm9kdWN0c0ZlYXR1cmUgPSBjcmVhdGVGZWF0dXJlKHtcbiAqICAgbmFtZTogJ3Byb2R1Y3RzJyxcbiAqICAgcmVkdWNlcjogY3JlYXRlUmVkdWNlcihcbiAqICAgICBpbml0aWFsU3RhdGUsXG4gKiAgICAgb24oUHJvZHVjdHNBcGlBY3Rpb25zLmxvYWRTdWNjZXNzKHN0YXRlLCB7IHByb2R1Y3RzIH0pID0+ICh7XG4gKiAgICAgICAuLi5zdGF0ZSxcbiAqICAgICAgIHByb2R1Y3RzLFxuICogICAgIH0pLFxuICogICApLFxuICogfSk7XG4gKlxuICogY29uc3Qge1xuICogICBuYW1lLFxuICogICByZWR1Y2VyLFxuICogICAvLyBmZWF0dXJlIHNlbGVjdG9yXG4gKiAgIHNlbGVjdFByb2R1Y3RzU3RhdGUsIC8vIHR5cGU6IE1lbW9pemVkU2VsZWN0b3I8UmVjb3JkPHN0cmluZywgYW55PiwgUHJvZHVjdHNTdGF0ZT5cbiAqICAgLy8gZmVhdHVyZSBzdGF0ZSBwcm9wZXJ0aWVzIHNlbGVjdG9yc1xuICogICBzZWxlY3RQcm9kdWN0cywgLy8gdHlwZTogTWVtb2l6ZWRTZWxlY3RvcjxSZWNvcmQ8c3RyaW5nLCBhbnk+LCBQcm9kdWN0W10+XG4gKiAgIHNlbGVjdFNlbGVjdGVkSWQsIC8vIHR5cGU6IE1lbW9pemVkU2VsZWN0b3I8UmVjb3JkPHN0cmluZywgYW55Piwgc3RyaW5nIHwgbnVsbD5cbiAqIH0gPSBwcm9kdWN0c0ZlYXR1cmU7XG4gKiBgYGBcbiAqXG4gKiAqKkNyZWF0aW5nIEZlYXR1cmUgd2l0aCBFeHRyYSBTZWxlY3RvcnMqKlxuICpcbiAqIGBgYHRzXG4gKiB0eXBlIENhbGxTdGF0ZSA9ICdpbml0JyB8ICdsb2FkaW5nJyB8ICdsb2FkZWQnIHwgeyBlcnJvcjogc3RyaW5nIH07XG4gKlxuICogaW50ZXJmYWNlIFN0YXRlIGV4dGVuZHMgRW50aXR5U3RhdGU8UHJvZHVjdD4ge1xuICogICBjYWxsU3RhdGU6IENhbGxTdGF0ZTtcbiAqIH1cbiAqXG4gKiBjb25zdCBhZGFwdGVyID0gY3JlYXRlRW50aXR5QWRhcHRlcjxQcm9kdWN0PigpO1xuICogY29uc3QgaW5pdGlhbFN0YXRlOiBTdGF0ZSA9IGFkYXB0ZXIuZ2V0SW5pdGlhbFN0YXRlKHtcbiAqICAgY2FsbFN0YXRlOiAnaW5pdCcsXG4gKiB9KTtcbiAqXG4gKiBleHBvcnQgY29uc3QgcHJvZHVjdHNGZWF0dXJlID0gY3JlYXRlRmVhdHVyZSh7XG4gKiAgIG5hbWU6ICdwcm9kdWN0cycsXG4gKiAgIHJlZHVjZXI6IGNyZWF0ZVJlZHVjZXIoaW5pdGlhbFN0YXRlKSxcbiAqICAgZXh0cmFTZWxlY3RvcnM6ICh7IHNlbGVjdFByb2R1Y3RzU3RhdGUsIHNlbGVjdENhbGxTdGF0ZSB9KSA9PiAoe1xuICogICAgIC4uLmFkYXB0ZXIuZ2V0U2VsZWN0b3JzKHNlbGVjdEJvb2tzU3RhdGUpLFxuICogICAgIC4uLmdldENhbGxTdGF0ZVNlbGVjdG9ycyhzZWxlY3RDYWxsU3RhdGUpXG4gKiAgIH0pLFxuICogfSk7XG4gKlxuICogY29uc3Qge1xuICogICBuYW1lLFxuICogICByZWR1Y2VyLFxuICogICAvLyBmZWF0dXJlIHNlbGVjdG9yXG4gKiAgIHNlbGVjdFByb2R1Y3RzU3RhdGUsXG4gKiAgIC8vIGZlYXR1cmUgc3RhdGUgcHJvcGVydGllcyBzZWxlY3RvcnNcbiAqICAgc2VsZWN0SWRzLFxuICogICBzZWxlY3RFbnRpdGllcyxcbiAqICAgc2VsZWN0Q2FsbFN0YXRlLFxuICogICAvLyBzZWxlY3RvcnMgcmV0dXJuZWQgYnkgYGFkYXB0ZXIuZ2V0U2VsZWN0b3JzYFxuICogICBzZWxlY3RBbGwsXG4gKiAgIHNlbGVjdFRvdGFsLFxuICogICAvLyBzZWxlY3RvcnMgcmV0dXJuZWQgYnkgYGdldENhbGxTdGF0ZVNlbGVjdG9yc2BcbiAqICAgc2VsZWN0SXNMb2FkaW5nLFxuICogICBzZWxlY3RJc0xvYWRlZCxcbiAqICAgc2VsZWN0RXJyb3IsXG4gKiB9ID0gcHJvZHVjdHNGZWF0dXJlO1xuICogYGBgXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVGZWF0dXJlPFxuICBBcHBTdGF0ZSBleHRlbmRzIFJlY29yZDxzdHJpbmcsIGFueT4sXG4gIEZlYXR1cmVOYW1lIGV4dGVuZHMga2V5b2YgQXBwU3RhdGUgJiBzdHJpbmcsXG4gIEZlYXR1cmVTdGF0ZSBleHRlbmRzIEFwcFN0YXRlW0ZlYXR1cmVOYW1lXSxcbiAgRXh0cmFTZWxlY3RvcnMgZXh0ZW5kcyBTZWxlY3RvcnNEaWN0aW9uYXJ5XG4+KFxuICBmZWF0dXJlQ29uZmlnOiBGZWF0dXJlQ29uZmlnPEZlYXR1cmVOYW1lLCBGZWF0dXJlU3RhdGU+ICYge1xuICAgIGV4dHJhU2VsZWN0b3JzPzogRXh0cmFTZWxlY3RvcnNGYWN0b3J5PFxuICAgICAgRmVhdHVyZU5hbWUsXG4gICAgICBGZWF0dXJlU3RhdGUsXG4gICAgICBFeHRyYVNlbGVjdG9yc1xuICAgID47XG4gIH1cbik6IEZlYXR1cmU8QXBwU3RhdGUsIEZlYXR1cmVOYW1lLCBGZWF0dXJlU3RhdGU+ICYgRXh0cmFTZWxlY3RvcnMge1xuICBjb25zdCB7XG4gICAgbmFtZSxcbiAgICByZWR1Y2VyLFxuICAgIGV4dHJhU2VsZWN0b3JzOiBleHRyYVNlbGVjdG9yc0ZhY3RvcnksXG4gIH0gPSBmZWF0dXJlQ29uZmlnO1xuXG4gIGNvbnN0IGZlYXR1cmVTZWxlY3RvciA9IGNyZWF0ZUZlYXR1cmVTZWxlY3RvcjxGZWF0dXJlU3RhdGU+KG5hbWUpO1xuICBjb25zdCBuZXN0ZWRTZWxlY3RvcnMgPSBjcmVhdGVOZXN0ZWRTZWxlY3RvcnMoZmVhdHVyZVNlbGVjdG9yLCByZWR1Y2VyKTtcbiAgY29uc3QgYmFzZVNlbGVjdG9ycyA9IHtcbiAgICBbYHNlbGVjdCR7Y2FwaXRhbGl6ZShuYW1lKX1TdGF0ZWBdOiBmZWF0dXJlU2VsZWN0b3IsXG4gICAgLi4ubmVzdGVkU2VsZWN0b3JzLFxuICB9IGFzIEJhc2VTZWxlY3RvcnM8UmVjb3JkPHN0cmluZywgYW55PiwgRmVhdHVyZU5hbWUsIEZlYXR1cmVTdGF0ZT47XG4gIGNvbnN0IGV4dHJhU2VsZWN0b3JzID0gZXh0cmFTZWxlY3RvcnNGYWN0b3J5XG4gICAgPyBleHRyYVNlbGVjdG9yc0ZhY3RvcnkoYmFzZVNlbGVjdG9ycylcbiAgICA6IHt9O1xuXG4gIHJldHVybiB7XG4gICAgbmFtZSxcbiAgICByZWR1Y2VyLFxuICAgIC4uLmJhc2VTZWxlY3RvcnMsXG4gICAgLi4uZXh0cmFTZWxlY3RvcnMsXG4gIH0gYXMgRmVhdHVyZTxBcHBTdGF0ZSwgRmVhdHVyZU5hbWUsIEZlYXR1cmVTdGF0ZT4gJiBFeHRyYVNlbGVjdG9ycztcbn1cblxuZnVuY3Rpb24gY3JlYXRlTmVzdGVkU2VsZWN0b3JzPFxuICBBcHBTdGF0ZSBleHRlbmRzIFJlY29yZDxzdHJpbmcsIGFueT4sXG4gIEZlYXR1cmVTdGF0ZVxuPihcbiAgZmVhdHVyZVNlbGVjdG9yOiBNZW1vaXplZFNlbGVjdG9yPEFwcFN0YXRlLCBGZWF0dXJlU3RhdGU+LFxuICByZWR1Y2VyOiBBY3Rpb25SZWR1Y2VyPEZlYXR1cmVTdGF0ZT5cbik6IE5lc3RlZFNlbGVjdG9yczxBcHBTdGF0ZSwgRmVhdHVyZVN0YXRlPiB7XG4gIGNvbnN0IGluaXRpYWxTdGF0ZSA9IGdldEluaXRpYWxTdGF0ZShyZWR1Y2VyKTtcbiAgY29uc3QgbmVzdGVkS2V5cyA9IChcbiAgICBpc1BsYWluT2JqZWN0KGluaXRpYWxTdGF0ZSkgPyBPYmplY3Qua2V5cyhpbml0aWFsU3RhdGUpIDogW11cbiAgKSBhcyBBcnJheTxrZXlvZiBGZWF0dXJlU3RhdGUgJiBzdHJpbmc+O1xuXG4gIHJldHVybiBuZXN0ZWRLZXlzLnJlZHVjZShcbiAgICAobmVzdGVkU2VsZWN0b3JzLCBuZXN0ZWRLZXkpID0+ICh7XG4gICAgICAuLi5uZXN0ZWRTZWxlY3RvcnMsXG4gICAgICBbYHNlbGVjdCR7Y2FwaXRhbGl6ZShuZXN0ZWRLZXkpfWBdOiBjcmVhdGVTZWxlY3RvcihcbiAgICAgICAgZmVhdHVyZVNlbGVjdG9yLFxuICAgICAgICAocGFyZW50U3RhdGUpID0+IHBhcmVudFN0YXRlPy5bbmVzdGVkS2V5XVxuICAgICAgKSxcbiAgICB9KSxcbiAgICB7fSBhcyBOZXN0ZWRTZWxlY3RvcnM8QXBwU3RhdGUsIEZlYXR1cmVTdGF0ZT5cbiAgKTtcbn1cblxuZnVuY3Rpb24gZ2V0SW5pdGlhbFN0YXRlPEZlYXR1cmVTdGF0ZT4oXG4gIHJlZHVjZXI6IEFjdGlvblJlZHVjZXI8RmVhdHVyZVN0YXRlPlxuKTogRmVhdHVyZVN0YXRlIHtcbiAgcmV0dXJuIHJlZHVjZXIodW5kZWZpbmVkLCB7IHR5cGU6ICdAbmdyeC9mZWF0dXJlL2luaXQnIH0pO1xufVxuIl19