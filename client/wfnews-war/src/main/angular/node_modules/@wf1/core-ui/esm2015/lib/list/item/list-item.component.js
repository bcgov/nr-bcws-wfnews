import { Component, EventEmitter, Input, Output } from "@angular/core";
import { IconSize, IncidentType } from "../../application-icon/application-icon.model";
import { MapService } from "../../services/map.service";
export class InternalListItemConfig {
}
export class ListItemComponent {
    constructor(mapService) {
        this.mapService = mapService;
        this.TOOLTIP_DELAY = 500;
        this.itemSelect = new EventEmitter();
    }
    ngOnInit() {
        if (this.config) {
            this.internalConfig = new InternalListItemConfig();
            this.internalConfig.icon = {
                type: this.config.icon,
                size: (this.config.time) ? IconSize.LIST_SMALL : IconSize.LIST_LARGE,
                colourCode: (this.config.iconColourCode !== undefined)
                    ? this.config.iconColourCode : IncidentType.DEFAULT,
                isBlinking: (this.config.iconIsBlinking !== undefined)
                    ? this.config.iconIsBlinking : false,
                isCancelled: (this.config.iconIsCancelled !== undefined)
                    ? this.config.iconIsCancelled : false,
                isAssignedToIncident: (this.config.iconIsAssignedToIncident !== undefined)
                    ? this.config.iconIsAssignedToIncident : false,
            };
            this.internalConfig.time = this.config.time;
            this.internalConfig.title = this.config.title;
            this.internalConfig.infoRows = [[null, null]];
            let currentRow = [null, null];
            this.internalConfig.infoRows.shift();
            console.log(this.config.info);
            for (let index = 0; index < this.config.info.length; index++) {
                if (index == 0) {
                    this.internalConfig.titleLevelInfo = this.config.info[index];
                }
                else {
                    let isFirstRowEntry = (index % 2);
                    if (isFirstRowEntry) {
                        currentRow[0] = this.config.info[index];
                    }
                    else {
                        currentRow[1] = this.config.info[index];
                        this.internalConfig.infoRows.push(currentRow);
                        currentRow = [null, null];
                    }
                }
            }
            this.internalConfig.location = this.config.location;
            if (currentRow[0]) { //If odd number of items, push half-finished row into set.
                this.internalConfig.infoRows.push(currentRow);
            }
        }
    }
    handleMouseEvent(location) {
        if (location) {
            this.mapService.addHighlight(this.mapElement, location);
        }
        else {
            this.mapService.clearHighlight(this.mapElement);
        }
    }
    handleClick() {
        this.itemSelect.emit(this.config);
    }
    zoomToPlace(location) {
        if (location) {
            this.mapService.zoomToPoint(this.mapElement, location);
        }
    }
}
ListItemComponent.decorators = [
    { type: Component, args: [{
                selector: 'wf1-list-item',
                template: "<mat-list-item class=\"list-item\" *ngIf=\"config\">\n  <div class=\"list-item-icon-section\" (mouseover)=\"handleMouseEvent(internalConfig.location)\" (mouseout)=\"handleMouseEvent()\" (focus)=\"handleMouseEvent(internalConfig.location)\" (blur)=\"handleMouseEvent()\" (click)=\"handleClick()\" (keydown)=\"handleClick()\">\n    <div class=\"list-item-icon\">\n      <wf1-application-icon\n              [iconType]=\"internalConfig.icon.type\"\n              [iconSize]=\"internalConfig.icon.size\"\n              [colourCode]=\"internalConfig.icon.colourCode\"\n              [isBlinking]=\"internalConfig.icon.isBlinking\"\n              [isCancelled]=\"internalConfig.icon.isCancelled\"\n              [isAssignedToIncident]=\"internalConfig.icon.isAssignedToIncident\"\n      ></wf1-application-icon>\n    </div>\n    <div *ngIf=\"internalConfig.time\" class=\"list-item-date\">{{internalConfig.time | amDateFormat: 'YYYY-MM-DD'}}</div>\n    <div *ngIf=\"internalConfig.time\" class=\"list-item-time\">{{internalConfig.time | amDateFormat: 'HH:mm:ss'}}</div>\n  </div>\n\n  <div class=\"list-item-data-section\">\n    <div class=\"list-item-title-section\">\n      <span class=\"list-item-title\" (mouseover)=\"handleMouseEvent(internalConfig.location)\" (mouseout)=\"handleMouseEvent()\" (click)=\"handleClick()\">{{internalConfig.title}}</span>\n      <span class=\"list-item-title-level-info\" (mouseover)=\"handleMouseEvent(internalConfig.location)\" (mouseout)=\"handleMouseEvent()\" (click)=\"handleClick()\">\n        <span class=\"list-item-info {{internalConfig.titleLevelInfo.fullWidth?'list-item-info-full-width':''}}\">\n          <span class=\"list-item-info-label\">{{internalConfig.titleLevelInfo.label}}:</span>\n          <span class=\"list-item-info-value {{internalConfig.titleLevelInfo.emphasis?'list-item-info-value-emphasis':''}}\"><strong>{{internalConfig.titleLevelInfo.value}}</strong></span>\n        </span>\n      </span>\n      <span class=\"list-item-locate-button\">\n        <button *ngIf=\"internalConfig.location\" mat-button (click)=\"zoomToPlace(internalConfig.location)\" matTooltip=\"Locate on Map\" [matTooltipShowDelay]=\"TOOLTIP_DELAY\"><mat-icon>place</mat-icon></button>\n      </span>\n    </div>\n\n    <ng-container *ngFor=\"let row of internalConfig.infoRows\">\n      <div class=\"list-item-info-row\" (mouseover)=\"handleMouseEvent(internalConfig.location)\" (mouseout)=\"handleMouseEvent()\" (focus)=\"handleMouseEvent(internalConfig.location)\" (blur)=\"handleMouseEvent()\" (click)=\"handleClick()\" (keydown)=\"handleClick()\">\n        <ng-container *ngFor=\"let column of row\">\n          <span class=\"list-item-info {{column.fullWidth?'list-item-info-full-width':''}}\" *ngIf=\"column\">\n            <span class=\"list-item-info-label\">{{column.label}}:</span>\n            <span class=\"list-item-info-value {{column.emphasis?'list-item-info-value-emphasis':''}}\"><strong>{{column.value}}</strong></span>\n          </span>\n        </ng-container>\n      </div>\n    </ng-container>\n  </div>\n</mat-list-item>\n",
                styles: ["mat-list-item.list-item{height:auto;padding:.25rem 0;border-bottom:.0625rem solid #c4c4c4}mat-list-item.list-item:hover{background-color:#eee;cursor:pointer}mat-list-item.list-item .list-item-icon-section{flex:0 0 5rem;width:5rem;height:100%;display:flex;flex-direction:column;justify-content:center;align-items:center}mat-list-item.list-item .list-item-icon-section .list-item-icon .mat-icon,mat-list-item.list-item .list-item-icon-section .list-item-icon .mat-icon svg,mat-list-item.list-item .list-item-icon-section .wf1-application-icon,mat-list-item.list-item .list-item-icon-section .wf1-application-icon svg,mat-list-item.list-item .list-item-icon-section .wf1-main-icon,mat-list-item.list-item .list-item-icon-section .wf1-main-icon svg,mat-list-item.list-item .list-item-icon-section wf1-application-icon,mat-list-item.list-item .list-item-icon-section wf1-application-icon svg{width:3rem;height:3rem}mat-list-item.list-item .list-item-icon-section .list-item-date,mat-list-item.list-item .list-item-icon-section .list-item-time{font-size:x-small;line-height:.75rem}mat-list-item.list-item .list-item-icon-section .list-item-date{padding-top:.5rem}mat-list-item.list-item .list-item-data-section{width:100%}mat-list-item.list-item .list-item-data-section .list-item-title-section{display:flex;justify-content:flex-start;align-items:baseline}mat-list-item.list-item .list-item-data-section .list-item-title-section .list-item-title{flex:0 0 9rem;display:inline-block;padding-right:1rem;margin-bottom:0;font-size:.9rem;font-weight:900}@media (-ms-high-contrast:active),(-ms-high-contrast:none){mat-list-item.list-item .list-item-data-section .list-item-title-section .list-item-title{padding-right:0}}mat-list-item.list-item .list-item-data-section .list-item-title-section .list-item-locate-button{height:1rem;width:1rem}mat-list-item.list-item .list-item-data-section .list-item-title-section .list-item-locate-button .mat-button{min-width:1rem;line-height:1rem;padding:0}mat-list-item.list-item .list-item-data-section .list-item-title-section .list-item-locate-button .mat-button .mat-icon{height:1rem;width:1rem;font-size:1rem}mat-list-item.list-item .list-item-data-section .list-item-info-row{display:flex;justify-content:flex-start;align-items:baseline}mat-list-item.list-item .list-item-data-section .list-item-info{flex:0 0 9rem;display:flex;justify-content:flex-start;font-size:small}mat-list-item.list-item .list-item-data-section .list-item-info .list-item-info-label{flex:0 0 3rem;padding-right:.5rem;width:3rem;font-size:x-small;text-transform:uppercase}mat-list-item.list-item .list-item-data-section .list-item-info .list-item-info-value{flex:0 0 6rem;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;width:6rem;margin-right:.5rem;font-size:.75rem}"]
            },] }
];
ListItemComponent.ctorParameters = () => [
    { type: MapService }
];
ListItemComponent.propDecorators = {
    config: [{ type: Input }],
    mapElement: [{ type: Input }],
    itemSelect: [{ type: Output }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGlzdC1pdGVtLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL2NvcmUtdWkvc3JjL2xpYi9saXN0L2l0ZW0vbGlzdC1pdGVtLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUMsU0FBUyxFQUFFLFlBQVksRUFBRSxLQUFLLEVBQVUsTUFBTSxFQUFDLE1BQU0sZUFBZSxDQUFDO0FBRzdFLE9BQU8sRUFBQyxRQUFRLEVBQVksWUFBWSxFQUFtQixNQUFNLCtDQUErQyxDQUFDO0FBQ2pILE9BQU8sRUFBQyxVQUFVLEVBQUMsTUFBTSw0QkFBNEIsQ0FBQztBQUV0RCxNQUFNLE9BQU8sc0JBQXNCO0NBY2xDO0FBT0QsTUFBTSxPQUFPLGlCQUFpQjtJQVk1QixZQUFvQixVQUFzQjtRQUF0QixlQUFVLEdBQVYsVUFBVSxDQUFZO1FBWG5DLGtCQUFhLEdBQUcsR0FBRyxDQUFDO1FBTzNCLGVBQVUsR0FBRyxJQUFJLFlBQVksRUFBa0IsQ0FBQztJQUlILENBQUM7SUFFOUMsUUFBUTtRQUNOLElBQUksSUFBSSxDQUFDLE1BQU0sRUFBRTtZQUNmLElBQUksQ0FBQyxjQUFjLEdBQUcsSUFBSSxzQkFBc0IsRUFBRSxDQUFDO1lBQ25ELElBQUksQ0FBQyxjQUFjLENBQUMsSUFBSSxHQUFHO2dCQUN6QixJQUFJLEVBQUUsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFnQjtnQkFDbEMsSUFBSSxFQUFFLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDLFVBQVU7Z0JBQ3BFLFVBQVUsRUFBRSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsY0FBYyxLQUFLLFNBQVMsQ0FBQztvQkFDcEQsQ0FBQyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsY0FBYyxDQUFDLENB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QVUsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBQ3BDLENBQUM7SUFFRCxXQUFXLENBQUMsUUFBMEI7UUFDcEMsSUFBSSxRQUFRLEVBQUU7WUFDWixJQUFJLENBQUMsVUFBVSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsVUFBVSxFQUFFLFFBQVEsQ0FBQyxDQUFDO1NBQ3hEO0lBQ0gsQ0FBQzs7O1lBOUVGLFNBQVMsU0FBQztnQkFDVCxRQUFRLEVBQUUsZUFBZTtnQkFDekIsb2hHQUF5Qzs7YUFFMUM7OztZQXRCTyxVQUFVOzs7cUJBMEJmLEtBQUs7eUJBRUwsS0FBSzt5QkFFTCxNQUFNIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtDb21wb25lbnQsIEV2ZW50RW1pdHRlciwgSW5wdXQsIE9uSW5pdCwgT3V0cHV0fSBmcm9tIFwiQGFuZ3VsYXIvY29yZVwiO1xuLy8gTW9kZWxzXG5pbXBvcnQge0luZm8sIExpc3RJdGVtQ29uZmlnfSBmcm9tIFwiLi9saXN0LWl0ZW0tY29uZmlnXCI7XG5pbXBvcnQge0ljb25TaXplLCBJY29uVHlwZSwgSW5jaWRlbnRUeXBlLCBSZXBvcnRPZkZpcmVUeXBlfSBmcm9tIFwiLi4vLi4vYXBwbGljYXRpb24taWNvbi9hcHBsaWNhdGlvbi1pY29uLm1vZGVsXCI7XG5pbXBvcnQge01hcFNlcnZpY2V9IGZyb20gXCIuLi8uLi9zZXJ2aWNlcy9tYXAuc2VydmljZVwiO1xuXG5leHBvcnQgY2xhc3MgSW50ZXJuYWxMaXN0SXRlbUNvbmZpZyB7XG4gIGljb246IHtcbiAgICB0eXBlOiBJY29uVHlwZTtcbiAgICBzaXplOiBJY29uU2l6ZTtcbiAgICBjb2xvdXJDb2RlOiBJbmNpZGVudFR5cGUgfCBSZXBvcnRPZkZpcmVUeXBlO1xuICAgIGlzQmxpbmtpbmc6IGJvb2xlYW47XG4gICAgaXNDYW5jZWxsZWQ6IGJvb2xlYW47XG4gICAgaXNBc3NpZ25lZFRvSW5jaWRlbnQ6IGJvb2xlYW47XG4gIH07XG4gIHRpbWU/OiBzdHJpbmc7XG4gIHRpdGxlOiBzdHJpbmc7XG4gIHRpdGxlTGV2ZWxJbmZvOiBJbmZvO1xuICBpbmZvUm93czogW1tJbmZvLEluZm9dXTtcbiAgbG9jYXRpb246IFtudW1iZXIsIG51bWJlcl07XG59XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ3dmMS1saXN0LWl0ZW0nLFxuICB0ZW1wbGF0ZVVybDogJy4vbGlzdC1pdGVtLmNvbXBvbmVudC5odG1sJyxcbiAgc3R5bGVVcmxzOiBbJy4vbGlzdC1pdGVtLmNvbXBvbmVudC5zY3NzJ11cbn0pXG5leHBvcnQgY2xhc3MgTGlzdEl0ZW1Db21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xuICBwdWJsaWMgVE9PTFRJUF9ERUxBWSA9IDUwMDtcblxuICBASW5wdXQoKVxuICBjb25maWc6IExpc3RJdGVtQ29uZmlnO1xuICBASW5wdXQoKVxuICBtYXBFbGVtZW50OiBzdHJpbmc7XG4gIEBPdXRwdXQoKVxuICBpdGVtU2VsZWN0ID0gbmV3IEV2ZW50RW1pdHRlcjxMaXN0SXRlbUNvbmZpZz4oKTtcblxuICBpbnRlcm5hbENvbmZpZzogSW50ZXJuYWxMaXN0SXRlbUNvbmZpZztcblxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIG1hcFNlcnZpY2U6IE1hcFNlcnZpY2UpIHt9XG5cbiAgbmdPbkluaXQoKSB7XG4gICAgaWYgKHRoaXMuY29uZmlnKSB7XG4gICAgICB0aGlzLmludGVybmFsQ29uZmlnID0gbmV3IEludGVybmFsTGlzdEl0ZW1Db25maWcoKTtcbiAgICAgIHRoaXMuaW50ZXJuYWxDb25maWcuaWNvbiA9IHtcbiAgICAgICAgdHlwZTogdGhpcy5jb25maWcuaWNvbiBhcyBJY29uVHlwZSxcbiAgICAgICAgc2l6ZTogKHRoaXMuY29uZmlnLnRpbWUpID8gSWNvblNpemUuTElTVF9TTUFMTCA6IEljb25TaXplLkxJU1RfTEFSR0UsXG4gICAgICAgIGNvbG91ckNvZGU6ICh0aGlzLmNvbmZpZy5pY29uQ29sb3VyQ29kZSAhPT0gdW5kZWZpbmVkKVxuICAgICAgICAgID8gdGhpcy5jb25maWcuaWNvbkNvbG91ckNvZGUgOiBJbmNpZGVudFR5cGUuREVGQVVMVCxcbiAgICAgICAgaXNCbGlua2luZzogKHRoaXMuY29uZmlnLmljb25Jc0JsaW5raW5nICE9PSB1bmRlZmluZWQpXG4gICAgICAgICAgPyB0aGlzLmNvbmZpZy5pY29uSXNCbGlua2luZyA6IGZhbHNlLFxuICAgICAgICBpc0NhbmNlbGxlZDogKHRoaXMuY29uZmlnLmljb25Jc0NhbmNlbGxlZCAhPT0gdW5kZWZpbmVkKVxuICAgICAgICAgID8gdGhpcy5jb25maWcuaWNvbklzQ2FuY2VsbGVkIDogZmFsc2UsXG4gICAgICAgIGlzQXNzaWduZWRUb0luY2lkZW50OiAodGhpcy5jb25maWcuaWNvbklzQXNzaWduZWRUb0luY2lkZW50ICE9PSB1bmRlZmluZWQpXG4gICAgICAgICAgPyB0aGlzLmNvbmZpZy5pY29uSXNBc3NpZ25lZFRvSW5jaWRlbnQgOiBmYWxzZSxcbiAgICAgIH07XG5cbiAgICAgIHRoaXMuaW50ZXJuYWxDb25maWcudGltZSA9IHRoaXMuY29uZmlnLnRpbWU7XG4gICAgICB0aGlzLmludGVybmFsQ29uZmlnLnRpdGxlID0gdGhpcy5jb25maWcudGl0bGU7XG4gICAgICB0aGlzLmludGVybmFsQ29uZmlnLmluZm9Sb3dzID0gW1tudWxsLCBudWxsXV07XG4gICAgICBsZXQgY3VycmVudFJvdzpbSW5mbywgSW5mb10gPSBbbnVsbCwgbnVsbF07XG4gICAgICB0aGlzLmludGVybmFsQ29uZmlnLmluZm9Sb3dzLnNoaWZ0KCk7XG4gICAgICBjb25zb2xlLmxvZyh0aGlzLmNvbmZpZy5pbmZvKTtcbiAgICAgIGZvciAobGV0IGluZGV4PTA7IGluZGV4PHRoaXMuY29uZmlnLmluZm8ubGVuZ3RoOyBpbmRleCsrKSB7XG4gICAgICAgIGlmIChpbmRleCA9PSAwKSB7XG4gICAgICAgICAgdGhpcy5pbnRlcm5hbENvbmZpZy50aXRsZUxldmVsSW5mbyA9IHRoaXMuY29uZmlnLmluZm9baW5kZXhdO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGxldCBpc0ZpcnN0Um93RW50cnkgPSAoaW5kZXggJSAyKTtcbiAgICAgICAgICBpZiAoaXNGaXJzdFJvd0VudHJ5KSB7XG4gICAgICAgICAgICBjdXJyZW50Um93WzBdID0gdGhpcy5jb25maWcuaW5mb1tpbmRleF07XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGN1cnJlbnRSb3dbMV0gPSB0aGlzLmNvbmZpZy5pbmZvW2luZGV4XTtcbiAgICAgICAgICAgIHRoaXMuaW50ZXJuYWxDb25maWcuaW5mb1Jvd3MucHVzaChjdXJyZW50Um93KTtcbiAgICAgICAgICAgIGN1cnJlbnRSb3cgPSBbbnVsbCwgbnVsbF07XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgICB0aGlzLmludGVybmFsQ29uZmlnLmxvY2F0aW9uID0gdGhpcy5jb25maWcubG9jYXRpb247XG4gICAgICBpZiAoY3VycmVudFJvd1swXSkgeyAvL0lmIG9kZCBudW1iZXIgb2YgaXRlbXMsIHB1c2ggaGFsZi1maW5pc2hlZCByb3cgaW50byBzZXQuXG4gICAgICAgIHRoaXMuaW50ZXJuYWxDb25maWcuaW5mb1Jvd3MucHVzaChjdXJyZW50Um93KTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBoYW5kbGVNb3VzZUV2ZW50KGxvY2F0aW9uPzogW251bWJlciwgbnVtYmVyXSkge1xuICAgIGlmIChsb2NhdGlvbikge1xuICAgICAgdGhpcy5tYXBTZXJ2aWNlLmFkZEhpZ2hsaWdodCh0aGlzLm1hcEVsZW1lbnQsIGxvY2F0aW9uKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5tYXBTZXJ2aWNlLmNsZWFySGlnaGxpZ2h0KHRoaXMubWFwRWxlbWVudCk7XG4gICAgfVxuICB9XG5cbiAgaGFuZGxlQ2xpY2soKSB7XG4gICAgdGhpcy5pdGVtU2VsZWN0LmVtaXQodGhpcy5jb25maWcpO1xuICB9XG5cbiAgem9vbVRvUGxhY2UobG9jYXRpb246IFtudW1iZXIsIG51bWJlcl0pIHtcbiAgICBpZiAobG9jYXRpb24pIHtcbiAgICAgIHRoaXMubWFwU2VydmljZS56b29tVG9Qb2ludCh0aGlzLm1hcEVsZW1lbnQsIGxvY2F0aW9uKTtcbiAgICB9XG4gIH1cbn1cbiJdfQ==