import { Component, Input } from "@angular/core";
import { AppConfigService } from "../services/app-config.service";
export class VisualizeJSComponent {
    constructor(appConfig) {
        this.appConfig = appConfig;
        this.currentPage = 1;
    }
    static handleError(err) {
        console.error(err.message);
    }
    ngOnInit() {
    }
    ngAfterViewInit() {
        const config = this.appConfig.getConfig();
        if (!config || !config.externalAppConfig || !config.externalAppConfig.jasper) {
            throw new Error('Could not find Jasper configuration settings in application configuration');
        }
        let themeHref = `${config.externalAppConfig.jasper.url}/_themes/${config.externalAppConfig.jasper.themeHash}/theme.css`.split("/").slice(0, -1).join("/");
        visualize.config({
            server: config.externalAppConfig.jasper.url,
            scripts: `runtime/${config.externalAppConfig.jasper.scriptsHash}/optimized-scripts`,
            logEnabled: true,
            logLevel: "error",
            _showInputControls: "true" === "true",
            theme: {
                href: themeHref
            }
        });
        // new Promise((resolve, reject) => {
        visualize({
            server: config.externalAppConfig.jasper.url
        }, (vis) => {
            let reportConfig = {
                resource: this.reportPath,
                container: `#${this.elementId}`,
                error: VisualizeJSComponent.handleError,
            };
            if (this.reportParams) {
                reportConfig.params = this.reportParams;
            }
            this.report = vis.report(reportConfig);
        });
        // }).then(result => this.report = result)
        //   .catch(error => console.error(error));
    }
    isExportFormatSupported(format) {
        if (format) {
            if (this.supportedExportFormats && this.supportedExportFormats.length > 0) {
                return this.supportedExportFormats.includes(format);
            }
        }
        return false;
    }
    exportToPDF() {
        this.export('pdf');
    }
    exportToExcel() {
        this.export('csv');
    }
    previousPage() {
        if (this.currentPage !== 1) {
            this.currentPage -= 1;
            this.report.pages(this.currentPage).run().fail((err) => console.error(err));
        }
    }
    nextPage() {
        this.currentPage += 1;
        this.report.pages(this.currentPage).run().fail((err) => {
            if (err.errorCode === 'page.number.out.of.range') {
                this.currentPage -= 1;
            }
            else {
                console.error(err);
            }
        });
    }
    export(outputFormat) {
        let params = { outputFormat: outputFormat,
            ignorePagination: outputFormat === 'csv' ? true : false
        };
        this.report.export(params)
            .done(function (link) {
            window.open(link.href); // open new window to download report
        })
            .fail(function (err) {
            alert(err.message);
        });
    }
}
VisualizeJSComponent.decorators = [
    { type: Component, args: [{
                selector: 'wf1-visualize-js',
                template: "<div class=\"wf1-jaspersoft-report\">\n  <div class=\"wf1-jaspersoft-report-toolbar\">\n    <button matTooltip=\"Export to PDF\" (click)=\"exportToPDF()\" [hidden]=\"!isExportFormatSupported('pdf')\"><mat-icon>picture_as_pdf</mat-icon></button>\n    <button matTooltip=\"Export to Excel\" (click)=\"exportToExcel()\" [hidden]=\"!isExportFormatSupported('csv')\"><mat-icon>table_chart</mat-icon></button>\n    <button matTooltip=\"Previous Page\" (click)=\"previousPage()\"><mat-icon>navigate_before</mat-icon></button>\n    <button matTooltip=\"Next Page\" (click)=\"nextPage()\"><mat-icon>navigate_next</mat-icon></button>\n  </div>\n  <div [id]=\"elementId\" class=\"wf1-jaspersoft-report-content\"></div>\n</div>\n",
                styles: [""]
            },] }
];
VisualizeJSComponent.ctorParameters = () => [
    { type: AppConfigService }
];
VisualizeJSComponent.propDecorators = {
    elementId: [{ type: Input }],
    reportPath: [{ type: Input }],
    reportParams: [{ type: Input }],
    supportedExportFormats: [{ type: Input }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidmlzdWFsaXplLWpzLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL2NvcmUtdWkvc3JjL2xpYi92aXN1YWxpemUtanMvdmlzdWFsaXplLWpzLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQWdCLFNBQVMsRUFBRSxLQUFLLEVBQVMsTUFBTSxlQUFlLENBQUM7QUFDdEUsT0FBTyxFQUFDLGdCQUFnQixFQUFDLE1BQU0sZ0NBQWdDLENBQUM7QUFnQmhFLE1BQU0sT0FBTyxvQkFBb0I7SUFFL0IsWUFBb0IsU0FBMkI7UUFBM0IsY0FBUyxHQUFULFNBQVMsQ0FBa0I7UUFZL0MsZ0JBQVcsR0FBRyxDQUFDLENBQUM7SUFWaEIsQ0FBQztJQWNELE1BQU0sQ0FBQyxXQUFXLENBQUMsR0FBRztRQUNwQixPQUFPLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsQ0FBQztJQUM3QixDQUFDO0lBRUQsUUFBUTtJQUVSLENBQUM7SUFFRCxlQUFlO1FBQ2IsTUFBTSxNQUFNLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxTQUFTLEVBQUUsQ0FBQztRQUMxQyxJQUFJLENBQUMsTUFBTSxJQUFJLENBQUMsTUFBTSxDQUFDLGlCQUFpQixJQUFJLENBQUMsTUFBTSxDQUFDLGlCQUFpQixDQUFDLE1BQU0sRUFBRTtZQUM1RSxNQUFNLElBQUksS0FBSyxDQUFDLDJFQUEyRSxDQUFDLENBQUM7U0FDOUY7UUFDQyxJQUFJLFNBQVMsR0FBRyxHQUFHLE1BQU0sQ0FBQyxpQkFBaUIsQ0FBQyxNQUFNLENBQUMsR0FBRyxZQUFZLE1BQU0sQ0FBQyxpQkFBaUIsQ0FBQyxNQUFNLENBQUMsU0FBUyxZQUFZLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENB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QyxNQUFNLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQzthQUN2QixJQUFJLENBQUMsVUFBVSxJQUFJO1lBQ2xCLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMscUNBQXFDO1FBQy9ELENBQUMsQ0FBQzthQUNELElBQUksQ0FBQyxVQUFVLEdBQUc7WUFDakIsS0FBSyxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUNyQixDQUFDLENBQUMsQ0FBQztJQUNQLENBQUM7OztZQWpIRixTQUFTLFNBQUM7Z0JBQ1QsUUFBUSxFQUFFLGtCQUFrQjtnQkFDNUIseXRCQUE0Qzs7YUFFN0M7OztZQWZPLGdCQUFnQjs7O3dCQXFCckIsS0FBSzt5QkFFTCxLQUFLOzJCQUVMLEtBQUs7cUNBRUwsS0FBSyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7QWZ0ZXJWaWV3SW5pdCwgQ29tcG9uZW50LCBJbnB1dCwgT25Jbml0fSBmcm9tIFwiQGFuZ3VsYXIvY29yZVwiO1xuaW1wb3J0IHtBcHBDb25maWdTZXJ2aWNlfSBmcm9tIFwiLi4vc2VydmljZXMvYXBwLWNvbmZpZy5zZXJ2aWNlXCI7XG5cbmRlY2xhcmUgdmFyIHZpc3VhbGl6ZTogYW55OyAvLyBMb2FkZWQgYnkgVmlzdWFsaXplLkpTIGFwaSBpbiB0aGUgcHJvamVjdCdzIGFuZ3VsYXIuanNvbiBmaWxlLlxuXG5pbnRlcmZhY2UgUmVwb3J0Q29uZmlnIHtcbiAgcmVzb3VyY2U6IHN0cmluZztcbiAgY29udGFpbmVyOiBzdHJpbmc7XG4gIGVycm9yOiBhbnk7XG4gIHBhcmFtcz86IGFueTtcbn1cblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnd2YxLXZpc3VhbGl6ZS1qcycsXG4gIHRlbXBsYXRlVXJsOiAnLi92aXN1YWxpemUtanMuY29tcG9uZW50Lmh0bWwnLFxuICBzdHlsZVVybHM6IFsnLi92aXN1YWxpemUtanMuY29tcG9uZW50LnNjc3MnXVxufSlcbmV4cG9ydCBjbGFzcyBWaXN1YWxpemVKU0NvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgQWZ0ZXJWaWV3SW5pdCB7XG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSBhcHBDb25maWc6IEFwcENvbmZpZ1NlcnZpY2UpIHtcblxuICB9XG4gIEBJbnB1dCgpXG4gIGVsZW1lbnRJZDogc3RyaW5nO1xuICBASW5wdXQoKVxuICByZXBvcnRQYXRoOiBzdHJpbmc7XG4gIEBJbnB1dCgpXG4gIHJlcG9ydFBhcmFtcz86IGFueTtcbiAgQElucHV0KClcbiAgc3VwcG9ydGVkRXhwb3J0Rm9ybWF0cz86IHN0cmluZ1tdO1xuXG4gIGN1cnJlbnRQYWdlID0gMTtcblxuICBwcml2YXRlIHJlcG9ydDogYW55O1xuXG4gIHN0YXRpYyBoYW5kbGVFcnJvcihlcnIpIHtcbiAgICBjb25zb2xlLmVycm9yKGVyci5tZXNzYWdlKTtcbiAgfVxuXG4gIG5nT25Jbml0KCkge1xuXG4gIH1cblxuICBuZ0FmdGVyVmlld0luaXQoKSB7XG4gICAgY29uc3QgY29uZmlnID0gdGhpcy5hcHBDb25maWcuZ2V0Q29uZmlnKCk7XG4gICAgaWYgKCFjb25maWcgfHwgIWNvbmZpZy5leHRlcm5hbEFwcENvbmZpZyB8fCAhY29uZmlnLmV4dGVybmFsQXBwQ29uZmlnLmphc3Blcikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdDb3VsZCBub3QgZmluZCBKYXNwZXIgY29uZmlndXJhdGlvbiBzZXR0aW5ncyBpbiBhcHBsaWNhdGlvbiBjb25maWd1cmF0aW9uJyk7XG4gICAgfVxuICAgICAgbGV0IHRoZW1lSHJlZiA9IGAke2NvbmZpZy5leHRlcm5hbEFwcENvbmZpZy5qYXNwZXIudXJsfS9fdGhlbWVzLyR7Y29uZmlnLmV4dGVybmFsQXBwQ29uZmlnLmphc3Blci50aGVtZUhhc2h9L3RoZW1lLmNzc2Auc3BsaXQoXCIvXCIpLnNsaWNlKDAsIC0xKS5qb2luKFwiL1wiKTtcblxuICAgICAgdmlzdWFsaXplLmNvbmZpZyh7XG4gICAgICAgICAgc2VydmVyIDogY29uZmlnLmV4dGVybmFsQXBwQ29uZmlnLmphc3Blci51cmwsXG4gICAgICAgICAgc2NyaXB0cyA6IGBydW50aW1lLyR7Y29uZmlnLmV4dGVybmFsQXBwQ29uZmlnLmphc3Blci5zY3JpcHRzSGFzaH0vb3B0aW1pemVkLXNjcmlwdHNgLFxuICAgICAgICAgIGxvZ0VuYWJsZWQ6IHRydWUsXG4gICAgICAgICAgbG9nTGV2ZWw6IFwiZXJyb3JcIixcbiAgICAgICAgICBfc2hvd0lucHV0Q29udHJvbHM6IFwidHJ1ZVwiID09PSBcInRydWVcIixcbiAgICAgICAgICB0aGVtZToge1xuICAgICAgICAgICAgICBocmVmOiB0aGVtZUhyZWZcbiAgICAgICAgICB9XG4gICAgICB9KTtcbiAgICAvLyBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG5cbiAgICB2aXN1YWxpemUoe1xuICAgICAgc2VydmVyOiBjb25maWcuZXh0ZXJuYWxBcHBDb25maWcuamFzcGVyLnVybFxuICAgIH0sICh2aXM6IGFueSkgPT4ge1xuICAgICAgbGV0IHJlcG9ydENvbmZpZzogYW55ID0ge1xuICAgICAgICByZXNvdXJjZTogdGhpcy5yZXBvcnRQYXRoLFxuICAgICAgICBjb250YWluZXI6IGAjJHt0aGlzLmVsZW1lbnRJZH1gLFxuICAgICAgICBlcnJvcjogVmlzdWFsaXplSlNDb21wb25lbnQuaGFuZGxlRXJyb3IsXG4gICAgICB9O1xuICAgICAgaWYgKHRoaXMucmVwb3J0UGFyYW1zKSB7XG4gICAgICAgIHJlcG9ydENvbmZpZy5wYXJhbXMgPSB0aGlzLnJlcG9ydFBhcmFtcztcbiAgICAgIH1cbiAgICAgIHRoaXMucmVwb3J0ID0gdmlzLnJlcG9ydChyZXBvcnRDb25maWcpO1xuICAgIH0pO1xuICAgIC8vIH0pLnRoZW4ocmVzdWx0ID0+IHRoaXMucmVwb3J0ID0gcmVzdWx0KVxuICAgIC8vICAgLmNhdGNoKGVycm9yID0+IGNvbnNvbGUuZXJyb3IoZXJyb3IpKTtcbiAgfVxuXG4gIGlzRXhwb3J0Rm9ybWF0U3VwcG9ydGVkKGZvcm1hdDogc3RyaW5nKSB7XG4gICAgaWYgKGZvcm1hdCkge1xuICAgICAgaWYgKHRoaXMuc3VwcG9ydGVkRXhwb3J0Rm9ybWF0cyAmJiB0aGlzLnN1cHBvcnRlZEV4cG9ydEZvcm1hdHMubGVuZ3RoID4gMCkge1xuICAgICAgICByZXR1cm4gdGhpcy5zdXBwb3J0ZWRFeHBvcnRGb3JtYXRzLmluY2x1ZGVzKGZvcm1hdCk7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIGV4cG9ydFRvUERGKCkge1xuICAgIHRoaXMuZXhwb3J0KCdwZGYnKTtcbiAgfVxuXG4gIGV4cG9ydFRvRXhjZWwoKSB7XG4gICAgdGhpcy5leHBvcnQoJ2NzdicpO1xuICB9XG5cbiAgcHJldmlvdXNQYWdlKCkge1xuICAgIGlmICh0aGlzLmN1cnJlbnRQYWdlICE9PSAxKSB7XG4gICAgICB0aGlzLmN1cnJlbnRQYWdlIC09IDE7XG4gICAgICB0aGlzLnJlcG9ydC5wYWdlcyh0aGlzLmN1cnJlbnRQYWdlKS5ydW4oKS5mYWlsKChlcnIpID0+IGNvbnNvbGUuZXJyb3IoZXJyKSk7XG4gICAgfVxuICB9XG5cbiAgbmV4dFBhZ2UoKSB7XG4gICAgdGhpcy5jdXJyZW50UGFnZSArPSAxO1xuICAgIHRoaXMucmVwb3J0LnBhZ2VzKHRoaXMuY3VycmVudFBhZ2UpLnJ1bigpLmZhaWwoKGVycikgPT4ge1xuICAgICAgaWYgKGVyci5lcnJvckNvZGUgPT09ICdwYWdlLm51bWJlci5vdXQub2YucmFuZ2UnKSB7XG4gICAgICAgIHRoaXMuY3VycmVudFBhZ2UgLT0gMTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgZXhwb3J0KG91dHB1dEZvcm1hdDogc3RyaW5nKSB7XG4gICAgbGV0IHBhcmFtcyA9IHsgb3V0cHV0Rm9ybWF0OiBvdXRwdXRGb3JtYXQsXG4gICAgICAgICAgICAgICAgICAgaWdub3JlUGFnaW5hdGlvbjogb3V0cHV0Rm9ybWF0ID09PSAnY3N2JyA/IHRydWUgOiBmYWxzZVxuICAgICAgICAgICAgICAgICB9O1xuICAgIHRoaXMucmVwb3J0LmV4cG9ydChwYXJhbXMpXG4gICAgICAuZG9uZShmdW5jdGlvbiAobGluaykge1xuICAgICAgICB3aW5kb3cub3BlbihsaW5rLmhyZWYpOyAvLyBvcGVuIG5ldyB3aW5kb3cgdG8gZG93bmxvYWQgcmVwb3J0XG4gICAgICB9KVxuICAgICAgLmZhaWwoZnVuY3Rpb24gKGVycikge1xuICAgICAgICBhbGVydChlcnIubWVzc2FnZSk7XG4gICAgICB9KTtcbiAgfVxufVxuIl19