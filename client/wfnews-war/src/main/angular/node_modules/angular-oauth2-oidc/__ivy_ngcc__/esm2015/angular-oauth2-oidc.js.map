{"version":3,"file":"angular-oauth2-oidc.js","sources":["angular-oauth2-oidc/out/types.ts","angular-oauth2-oidc/out/token-validation/validation-handler.ts","angular-oauth2-oidc/out/url-helper.service.ts","angular-oauth2-oidc/out/events.ts","angular-oauth2-oidc/out/base64-helper.ts","angular-oauth2-oidc/out/auth.config.ts","angular-oauth2-oidc/out/encoder.ts","angular-oauth2-oidc/out/oauth-service.ts","angular-oauth2-oidc/out/oauth-module.config.ts","angular-oauth2-oidc/out/interceptors/resource-server-error-handler.ts","angular-oauth2-oidc/out/interceptors/default-oauth.interceptor.ts","angular-oauth2-oidc/out/token-validation/null-validation-handler.ts","angular-oauth2-oidc/out/angular-oauth-oidic.module.ts","angular-oauth2-oidc/out/token-validation/jwks-validation-handler.ts","angular-oauth2-oidc/out/tokens.ts"],"names":["rs.KEYUTIL","rs.KJUR"],"mappings":"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","sourcesContent":["/**\r\n * Additional options that can be passt to tryLogin.\r\n */\r\nexport class LoginOptions {\r\n  /**\r\n   * Is called, after a token has been received and\r\n   * successfully validated.\r\n   *\r\n   * Deprecated:  Use property ``events`` on OAuthService instead.\r\n   */\r\n  onTokenReceived?: (receivedTokens: ReceivedTokens) => void;\r\n\r\n  /**\r\n   * Hook, to validate the received tokens.\r\n   * Deprecated:  Use property ``tokenValidationHandler`` on OAuthService instead.\r\n   */\r\n  validationHandler?: (receivedTokens: ReceivedTokens) => Promise<any>;\r\n\r\n  /**\r\n   * Called when tryLogin detects that the auth server\r\n   * included an error message into the hash fragment.\r\n   *\r\n   * Deprecated:  Use property ``events`` on OAuthService instead.\r\n   */\r\n  onLoginError?: (params: object) => void;\r\n\r\n  /**\r\n   * A custom hash fragment to be used instead of the\r\n   * actual one. This is used for silent refreshes, to\r\n   * pass the iframes hash fragment to this method.\r\n   */\r\n  customHashFragment?: string;\r\n\r\n  /**\r\n   * Set this to true to disable the oauth2 state\r\n   * check which is a best practice to avoid\r\n   * security attacks.\r\n   * As OIDC defines a nonce check that includes\r\n   * this, this can be set to true when only doing\r\n   * OIDC.\r\n   */\r\n  disableOAuth2StateCheck?: boolean;\r\n\r\n  /**\r\n   * Normally, you want to clear your hash fragment after\r\n   * the lib read the token(s) so that they are not displayed\r\n   * anymore in the url. If not, set this to true.\r\n   */\r\n  preventClearHashAfterLogin? = false;\r\n}\r\n\r\n/**\r\n * Defines a simple storage that can be used for\r\n * storing the tokens at client side.\r\n * Is compatible to localStorage and sessionStorage,\r\n * but you can also create your own implementations.\r\n */\r\nexport abstract class OAuthStorage {\r\n  abstract getItem(key: string): string | null;\r\n  abstract removeItem(key: string): void;\r\n  abstract setItem(key: string, data: string): void;\r\n}\r\n\r\n/**\r\n * Represents the received tokens, the received state\r\n * and the parsed claims from the id-token.\r\n */\r\nexport class ReceivedTokens {\r\n  idToken: string;\r\n  accessToken: string;\r\n  idClaims?: object;\r\n  state?: string;\r\n}\r\n\r\n/**\r\n * Represents the parsed and validated id_token.\r\n */\r\nexport interface ParsedIdToken {\r\n  idToken: string;\r\n  idTokenClaims: object;\r\n  idTokenHeader: object;\r\n  idTokenClaimsJson: string;\r\n  idTokenHeaderJson: string;\r\n  idTokenExpiresAt: number;\r\n}\r\n\r\n/**\r\n * Represents the response from the token endpoint\r\n * http://openid.net/specs/openid-connect-core-1_0.html#TokenEndpoint\r\n */\r\nexport interface TokenResponse {\r\n  access_token: string;\r\n  token_type: string;\r\n  expires_in: number;\r\n  refresh_token: string;\r\n  scope: string;\r\n  state?: string;\r\n}\r\n\r\n/**\r\n * Represents the response from the user info endpoint\r\n * http://openid.net/specs/openid-connect-core-1_0.html#UserInfo\r\n */\r\nexport interface UserInfo {\r\n  sub: string;\r\n  [key: string]: any;\r\n}\r\n\r\n/**\r\n * Represents an OpenID Connect discovery document\r\n */\r\nexport interface OidcDiscoveryDoc {\r\n  issuer: string;\r\n  authorization_endpoint: string;\r\n  token_endpoint: string;\r\n  token_endpoint_auth_methods_supported: string[];\r\n  token_endpoint_auth_signing_alg_values_supported: string[];\r\n  userinfo_endpoint: string;\r\n  check_session_iframe: string;\r\n  end_session_endpoint: string;\r\n  jwks_uri: string;\r\n  registration_endpoint: string;\r\n  scopes_supported: string[];\r\n  response_types_supported: string[];\r\n  acr_values_supported: string[];\r\n  response_modes_supported: string[];\r\n  grant_types_supported: string[];\r\n  subject_types_supported: string[];\r\n  userinfo_signing_alg_values_supported: string[];\r\n  userinfo_encryption_alg_values_supported: string[];\r\n  userinfo_encryption_enc_values_supported: string[];\r\n  id_token_signing_alg_values_supported: string[];\r\n  id_token_encryption_alg_values_supported: string[];\r\n  id_token_encryption_enc_values_supported: string[];\r\n  request_object_signing_alg_values_supported: string[];\r\n  display_values_supported: string[];\r\n  claim_types_supported: string[];\r\n  claims_supported: string[];\r\n  claims_parameter_supported: boolean;\r\n  service_documentation: string;\r\n  ui_locales_supported: string[];\r\n}\r\n","export interface ValidationParams {\r\n  idToken: string;\r\n  accessToken: string;\r\n  idTokenHeader: object;\r\n  idTokenClaims: object;\r\n  jwks: object;\r\n  loadKeys: () => Promise<object>;\r\n}\r\n\r\n/**\r\n * Interface for Handlers that are hooked in to\r\n * validate tokens.\r\n */\r\nexport abstract class ValidationHandler {\r\n  /**\r\n   * Validates the signature of an id_token.\r\n   */\r\n  public abstract validateSignature(\r\n    validationParams: ValidationParams\r\n  ): Promise<any>;\r\n\r\n  /**\r\n   * Validates the at_hash in an id_token against the received access_token.\r\n   */\r\n  public abstract validateAtHash(validationParams: ValidationParams): boolean;\r\n}\r\n\r\n/**\r\n * This abstract implementation of ValidationHandler already implements\r\n * the method validateAtHash. However, to make use of it,\r\n * you have to override the method calcHash.\r\n */\r\nexport abstract class AbstractValidationHandler implements ValidationHandler {\r\n  /**\r\n   * Validates the signature of an id_token.\r\n   */\r\n  abstract validateSignature(validationParams: ValidationParams): Promise<any>;\r\n\r\n  /**\r\n   * Validates the at_hash in an id_token against the received access_token.\r\n   */\r\n  validateAtHash(params: ValidationParams): boolean {\r\n    let hashAlg = this.inferHashAlgorithm(params.idTokenHeader);\r\n\r\n    let tokenHash = this.calcHash(params.accessToken, hashAlg); // sha256(accessToken, { asString: true });\r\n\r\n    let leftMostHalf = tokenHash.substr(0, tokenHash.length / 2);\r\n\r\n    let tokenHashBase64 = btoa(leftMostHalf);\r\n\r\n    let atHash = tokenHashBase64\r\n      .replace(/\\+/g, '-')\r\n      .replace(/\\//g, '_')\r\n      .replace(/=/g, '');\r\n    let claimsAtHash = params.idTokenClaims['at_hash'].replace(/=/g, '');\r\n\r\n    if (atHash !== claimsAtHash) {\r\n      console.error('exptected at_hash: ' + atHash);\r\n      console.error('actual at_hash: ' + claimsAtHash);\r\n    }\r\n\r\n    return atHash === claimsAtHash;\r\n  }\r\n\r\n  /**\r\n   * Infers the name of the hash algorithm to use\r\n   * from the alg field of an id_token.\r\n   *\r\n   * @param jwtHeader the id_token's parsed header\r\n   */\r\n  protected inferHashAlgorithm(jwtHeader: object): string {\r\n    let alg: string = jwtHeader['alg'];\r\n\r\n    if (!alg.match(/^.S[0-9]{3}$/)) {\r\n      throw new Error('Algorithm not supported: ' + alg);\r\n    }\r\n\r\n    return 'sha' + alg.substr(2);\r\n  }\r\n\r\n  /**\r\n   * Calculates the hash for the passed value by using\r\n   * the passed hash algorithm.\r\n   *\r\n   * @param valueToHash\r\n   * @param algorithm\r\n   */\r\n  protected abstract calcHash(valueToHash: string, algorithm: string): string;\r\n}\r\n","import { Injectable } from '@angular/core';\r\n\r\n@Injectable()\r\nexport class UrlHelperService {\r\n  public getHashFragmentParams(customHashFragment?: string): object {\r\n    let hash = customHashFragment || window.location.hash;\r\n\r\n    hash = decodeURIComponent(hash);\r\n\r\n    if (hash.indexOf('#') !== 0) {\r\n      return {};\r\n    }\r\n\r\n    const questionMarkPosition = hash.indexOf('?');\r\n\r\n    if (questionMarkPosition > -1) {\r\n      hash = hash.substr(questionMarkPosition + 1);\r\n    } else {\r\n      hash = hash.substr(1);\r\n    }\r\n\r\n    return this.parseQueryString(hash);\r\n  }\r\n\r\n  public parseQueryString(queryString: string): object {\r\n    const data = {};\r\n    let\r\n      pairs,\r\n      pair,\r\n      separatorIndex,\r\n      escapedKey,\r\n      escapedValue,\r\n      key,\r\n      value;\r\n\r\n    if (queryString === null) {\r\n      return data;\r\n    }\r\n\r\n    pairs = queryString.split('&');\r\n\r\n    for (let i = 0; i < pairs.length; i++) {\r\n      pair = pairs[i];\r\n      separatorIndex = pair.indexOf('=');\r\n\r\n      if (separatorIndex === -1) {\r\n        escapedKey = pair;\r\n        escapedValue = null;\r\n      } else {\r\n        escapedKey = pair.substr(0, separatorIndex);\r\n        escapedValue = pair.substr(separatorIndex + 1);\r\n      }\r\n\r\n      key = decodeURIComponent(escapedKey);\r\n      value = decodeURIComponent(escapedValue);\r\n\r\n      if (key.substr(0, 1) === '/') { key = key.substr(1); }\r\n\r\n      data[key] = value;\r\n    }\r\n\r\n    return data;\r\n  }\r\n}\r\n","export type EventType =\r\n  | 'discovery_document_loaded'\r\n  | 'received_first_token'\r\n  | 'jwks_load_error'\r\n  | 'invalid_nonce_in_state'\r\n  | 'discovery_document_load_error'\r\n  | 'discovery_document_validation_error'\r\n  | 'user_profile_loaded'\r\n  | 'user_profile_load_error'\r\n  | 'token_received'\r\n  | 'token_error'\r\n  | 'token_refreshed'\r\n  | 'token_refresh_error'\r\n  | 'silent_refresh_error'\r\n  | 'silently_refreshed'\r\n  | 'silent_refresh_timeout'\r\n  | 'token_validation_error'\r\n  | 'token_expires'\r\n  | 'session_changed'\r\n  | 'session_error'\r\n  | 'session_terminated'\r\n  | 'logout';\r\n\r\nexport abstract class OAuthEvent {\r\n  constructor(readonly type: EventType) {}\r\n}\r\n\r\nexport class OAuthSuccessEvent extends OAuthEvent {\r\n  constructor(type: EventType, readonly info: any = null) {\r\n    super(type);\r\n  }\r\n}\r\n\r\nexport class OAuthInfoEvent extends OAuthEvent {\r\n  constructor(type: EventType, readonly info: any = null) {\r\n    super(type);\r\n  }\r\n}\r\n\r\nexport class OAuthErrorEvent extends OAuthEvent {\r\n  constructor(\r\n    type: EventType,\r\n    readonly reason: object,\r\n    readonly params: object = null\r\n  ) {\r\n    super(type);\r\n  }\r\n}\r\n","// see: https://developer.mozilla.org/en-US/docs/Web/API/WindowBase64/Base64_encoding_and_decoding#The_.22Unicode_Problem.22\r\nexport function b64DecodeUnicode(str) {\r\n  const base64 = str.replace(/\\-/g, '+').replace(/\\_/g, '/');\r\n\r\n  return decodeURIComponent(\r\n    atob(base64)\r\n      .split('')\r\n      .map(function(c) {\r\n        return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);\r\n      })\r\n      .join('')\r\n  );\r\n}\r\n","export class AuthConfig {\r\n  /**\r\n   * The client's id as registered with the auth server\r\n   */\r\n  public clientId? = '';\r\n\r\n  /**\r\n   * The client's redirectUri as registered with the auth server\r\n   */\r\n  public redirectUri? = '';\r\n\r\n  /**\r\n   * An optional second redirectUri where the auth server\r\n   * redirects the user to after logging out.\r\n   */\r\n  public postLogoutRedirectUri? = '';\r\n\r\n  /**\r\n   * The auth server's endpoint that allows to log\r\n   * the user in when using implicit flow.\r\n   */\r\n  public loginUrl? = '';\r\n\r\n  /**\r\n   * The requested scopes\r\n   */\r\n  public scope? = 'openid profile';\r\n\r\n  public resource? = '';\r\n\r\n  public rngUrl? = '';\r\n\r\n  /**\r\n   * Defines whether to use OpenId Connect during\r\n   * implicit flow.\r\n   */\r\n  public oidc? = true;\r\n\r\n  /**\r\n   * Defines whether to request a access token during\r\n   * implicit flow.\r\n   */\r\n  public requestAccessToken? = true;\r\n\r\n  public options?: any = null;\r\n\r\n  /**\r\n   * The issuer's uri.\r\n   */\r\n  public issuer? = '';\r\n\r\n  /**\r\n   * The logout url.\r\n   */\r\n  public logoutUrl? = '';\r\n\r\n  /**\r\n   * Defines whether to clear the hash fragment after logging in.\r\n   */\r\n  public clearHashAfterLogin? = true;\r\n\r\n  /**\r\n   * Url of the token endpoint as defined by OpenId Connect and OAuth 2.\r\n   */\r\n  public tokenEndpoint?: string = null;\r\n\r\n  /**\r\n   * Url of the userinfo endpoint as defined by OpenId Connect.\r\n   *\r\n   */\r\n  public userinfoEndpoint?: string = null;\r\n\r\n  public responseType? = 'token';\r\n\r\n  /**\r\n   * Defines whether additional debug information should\r\n   * be shown at the console. Note that in certain browsers\r\n   * the verbosity of the console needs to be explicitly set\r\n   * to include Debug level messages.\r\n   */\r\n   public showDebugInformation? = false;\r\n\r\n  /**\r\n   * The redirect uri used when doing silent refresh.\r\n   */\r\n  public silentRefreshRedirectUri? = '';\r\n\r\n  public silentRefreshMessagePrefix? = '';\r\n\r\n  /**\r\n   * Set this to true to display the iframe used for\r\n   * silent refresh for debugging.\r\n   */\r\n  public silentRefreshShowIFrame? = false;\r\n\r\n  /**\r\n   * Timeout for silent refresh.\r\n   * @internal\r\n   * depreacted b/c of typo, see silentRefreshTimeout\r\n   */\r\n  public siletRefreshTimeout?: number = 1000 * 20;\r\n\r\n  /**\r\n   * Timeout for silent refresh.\r\n   */\r\n  public silentRefreshTimeout?: number = 1000 * 20;\r\n\r\n  /**\r\n   * Some auth servers don't allow using password flow\r\n   * w/o a client secreat while the standards do not\r\n   * demand for it. In this case, you can set a password\r\n   * here. As this passwort is exposed to the public\r\n   * it does not bring additional security and is therefore\r\n   * as good as using no password.\r\n   */\r\n  public dummyClientSecret?: string = null;\r\n\r\n  /**\r\n   * Defines whether https is required.\r\n   * The default value is remoteOnly which only allows\r\n   * http for localhost, while every other domains need\r\n   * to be used with https.\r\n   */\r\n  public requireHttps?: boolean | 'remoteOnly' = 'remoteOnly';\r\n\r\n  /**\r\n   * Defines whether every url provided by the discovery\r\n   * document has to start with the issuer's url.\r\n   */\r\n  public strictDiscoveryDocumentValidation? = true;\r\n\r\n  /**\r\n   * JSON Web Key Set (https://tools.ietf.org/html/rfc7517)\r\n   * with keys used to validate received id_tokens.\r\n   * This is taken out of the disovery document. Can be set manually too.\r\n   */\r\n  public jwks?: object = null;\r\n\r\n  /**\r\n   * Map with additional query parameter that are appended to\r\n   * the request when initializing implicit flow.\r\n   */\r\n  public customQueryParams?: object = null;\r\n\r\n  public silentRefreshIFrameName? = 'angular-oauth-oidc-silent-refresh-iframe';\r\n\r\n  /**\r\n   * Defines when the token_timeout event should be raised.\r\n   * If you set this to the default value 0.75, the event\r\n   * is triggered after 75% of the token's life time.\r\n   */\r\n  public timeoutFactor? = 0.75;\r\n\r\n  /**\r\n   * If true, the lib will try to check whether the user\r\n   * is still logged in on a regular basis as described\r\n   * in http://openid.net/specs/openid-connect-session-1_0.html#ChangeNotification\r\n   */\r\n  public sessionChecksEnabled? = false;\r\n\r\n  /**\r\n   * Intervall in msec for checking the session\r\n   * according to http://openid.net/specs/openid-connect-session-1_0.html#ChangeNotification\r\n   */\r\n  public sessionCheckIntervall? = 3 * 1000;\r\n\r\n  /**\r\n   * Url for the iframe used for session checks\r\n   */\r\n  public sessionCheckIFrameUrl?: string = null;\r\n\r\n  /**\r\n   * Name of the iframe to use for session checks\r\n   */\r\n  public sessionCheckIFrameName? = 'angular-oauth-oidc-check-session-iframe';\r\n\r\n  /**\r\n   * This property has been introduced to disable at_hash checks\r\n   * and is indented for Identity Provider that does not deliver\r\n   * an at_hash EVEN THOUGH its recommended by the OIDC specs.\r\n   * Of course, when disabling these checks the we are bypassing\r\n   * a security check which means we are more vulnerable.\r\n   */\r\n  public disableAtHashCheck? = false;\r\n\r\n  /*\r\n     * Defines wether to check the subject of a refreshed token after silent refresh.\r\n     * Normally, it should be the same as before.\r\n    */\r\n  public skipSubjectCheck? = false;\r\n\r\n  public useIdTokenHintForSilentRefresh? = false;\r\n\r\n  /*\r\n     * Defined whether to skip the validation of the issuer in the discovery document.\r\n     * Normally, the discovey document's url starts with the url of the issuer.\r\n     */\r\n  public skipIssuerCheck? = false;\r\n\r\n  /**\r\n   * According to rfc6749 it is recommended (but not required) that the auth\r\n   * server exposes the access_token's life time in seconds.\r\n   * This is a fallback value for the case this value is not exposed.\r\n   */\r\n  public fallbackAccessTokenExpirationTimeInSec?: number;\r\n\r\n  /*\r\n     * final state sent to issuer is built as follows:\r\n     * state = nonce + nonceStateSeparator + additional state\r\n     * Default separator is ';' (encoded %3B).\r\n     * In rare cases, this character might be forbidden or inconvenient to use by the issuer so it can be customized.\r\n     */\r\n  public nonceStateSeparator? = ';';\r\n\r\n  /*\r\n   * set this to true to use HTTP BASIC auth for password flow\r\n  */\r\n  public useHttpBasicAuthForPasswordFlow? = false;\r\n\r\n  constructor(json?: Partial<AuthConfig>) {\r\n    if (json) {\r\n      Object.assign(this, json);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * This property allows you to override the method that is used to open the login url,\r\n   * allowing a way for implementations to specify their own method of routing to new\r\n   * urls.\r\n   */\r\n  public openUri?: ((uri: string) => void) = uri => {\r\n    location.href = uri;\r\n  }\r\n}\r\n","import { HttpParameterCodec } from '@angular/common/http';\r\n/**\r\n * This custom encoder allows charactes like +, % and / to be used in passwords\r\n */\r\nexport class WebHttpUrlEncodingCodec implements HttpParameterCodec {\r\n  encodeKey(k: string): string {\r\n    return encodeURIComponent(k);\r\n  }\r\n\r\n  encodeValue(v: string): string {\r\n    return encodeURIComponent(v);\r\n  }\r\n\r\n  decodeKey(k: string): string {\r\n    return decodeURIComponent(k);\r\n  }\r\n\r\n  decodeValue(v: string) {\r\n    return decodeURIComponent(v);\r\n  }\r\n}\r\n","import { Injectable, NgZone, Optional } from '@angular/core';\r\nimport { HttpClient, HttpHeaders, HttpParams } from '@angular/common/http';\r\nimport { Observable, Subject, Subscription, of, race } from 'rxjs';\r\nimport { filter, take, delay, first, tap, map } from 'rxjs/operators';\r\n\r\nimport {\r\n    ValidationHandler,\r\n    ValidationParams\r\n} from './token-validation/validation-handler';\r\nimport { UrlHelperService } from './url-helper.service';\r\nimport {\r\n    OAuthEvent,\r\n    OAuthInfoEvent,\r\n    OAuthErrorEvent,\r\n    OAuthSuccessEvent\r\n} from './events';\r\nimport {\r\n    OAuthStorage,\r\n    LoginOptions,\r\n    ParsedIdToken,\r\n    OidcDiscoveryDoc,\r\n    TokenResponse,\r\n    UserInfo\r\n} from './types';\r\nimport { b64DecodeUnicode } from './base64-helper';\r\nimport { AuthConfig } from './auth.config';\r\nimport { WebHttpUrlEncodingCodec } from './encoder';\r\n\r\n/**\r\n * Service for logging in and logging out with\r\n * OIDC and OAuth2. Supports implicit flow and\r\n * password flow.\r\n */\r\n@Injectable()\r\nexport class OAuthService extends AuthConfig {\r\n    // extending AuthConfig ist just for LEGACY reasons\r\n    // to not break existing code\r\n\r\n    /**\r\n     * The ValidationHandler used to validate received\r\n     * id_tokens.\r\n     */\r\n    public tokenValidationHandler: ValidationHandler;\r\n\r\n    /**\r\n     * @internal\r\n     * Deprecated:  use property events instead\r\n     */\r\n    public discoveryDocumentLoaded = false;\r\n\r\n    /**\r\n     * @internal\r\n     * Deprecated:  use property events instead\r\n     */\r\n    public discoveryDocumentLoaded$: Observable<object>;\r\n\r\n    /**\r\n     * Informs about events, like token_received or token_expires.\r\n     * See the string enum EventType for a full list of events.\r\n     */\r\n    public events: Observable<OAuthEvent>;\r\n\r\n    /**\r\n     * The received (passed around) state, when logging\r\n     * in with implicit flow.\r\n     */\r\n    public state?= '';\r\n\r\n    private eventsSubject: Subject<OAuthEvent> = new Subject<OAuthEvent>();\r\n    private discoveryDocumentLoadedSubject: Subject<object> = new Subject<\r\n        object\r\n        >();\r\n    private silentRefreshPostMessageEventListener: EventListener;\r\n    private grantTypesSupported: Array<string> = [];\r\n    private _storage: OAuthStorage;\r\n    private accessTokenTimeoutSubscription: Subscription;\r\n    private idTokenTimeoutSubscription: Subscription;\r\n    private sessionCheckEventListener: EventListener;\r\n    private jwksUri: string;\r\n    private sessionCheckTimer: any;\r\n    private silentRefreshSubject: string;\r\n    private inImplicitFlow = false;\r\n\r\n    constructor(\r\n        private ngZone: NgZone,\r\n        private http: HttpClient,\r\n        @Optional() storage: OAuthStorage,\r\n        @Optional() tokenValidationHandler: ValidationHandler,\r\n        @Optional() private config: AuthConfig,\r\n        private urlHelper: UrlHelperService\r\n    ) {\r\n        super();\r\n\r\n        this.discoveryDocumentLoaded$ = this.discoveryDocumentLoadedSubject.asObservable();\r\n        this.events = this.eventsSubject.asObservable();\r\n\r\n        if (tokenValidationHandler) {\r\n            this.tokenValidationHandler = tokenValidationHandler;\r\n        }\r\n\r\n        if (config) {\r\n            this.configure(config);\r\n        }\r\n\r\n        try {\r\n            if (storage) {\r\n                this.setStorage(storage);\r\n            } else if (typeof sessionStorage !== 'undefined') {\r\n                this.setStorage(sessionStorage);\r\n            }\r\n        } catch (e) {\r\n            console.error(\r\n                'cannot access sessionStorage. Consider setting an own storage implementation using setStorage',\r\n                e\r\n            );\r\n        }\r\n        this.setupRefreshTimer();\r\n    }\r\n\r\n    /**\r\n     * Use this method to configure the service\r\n     * @param config the configuration\r\n     */\r\n    public configure(config: AuthConfig) {\r\n        // For the sake of downward compatibility with\r\n        // original configuration API\r\n        Object.assign(this, new AuthConfig(), config);\r\n\r\n        this.config = Object.assign({} as AuthConfig, new AuthConfig(), config);\r\n\r\n        if (this.sessionChecksEnabled) {\r\n            this.setupSessionCheck();\r\n        }\r\n\r\n        this.configChanged();\r\n    }\r\n\r\n    private configChanged(): void { }\r\n\r\n    public restartSessionChecksIfStillLoggedIn(): void {\r\n        if (this.hasValidIdToken()) {\r\n            this.initSessionCheck();\r\n        }\r\n    }\r\n\r\n    private restartRefreshTimerIfStillLoggedIn(): void {\r\n        this.setupExpirationTimers();\r\n    }\r\n\r\n    private setupSessionCheck() {\r\n        this.events.pipe(filter(e => e.type === 'token_received')).subscribe(e => {\r\n            this.initSessionCheck();\r\n        });\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param params Additional parameter to pass\r\n     */\r\n    public setupAutomaticSilentRefresh(params: object = {}) {\r\n        this.events.pipe(filter(e => e.type === 'token_expires')).subscribe(e => {\r\n            this.silentRefresh(params).catch(_ => {\r\n                this.debug('automatic silent refresh did not work');\r\n            });\r\n        });\r\n\r\n        this.restartRefreshTimerIfStillLoggedIn();\r\n    }\r\n\r\n    public loadDiscoveryDocumentAndTryLogin(options: LoginOptions = null) {\r\n        return this.loadDiscoveryDocument().then(doc => {\r\n            return this.tryLogin(options);\r\n        });\r\n    }\r\n\r\n    public loadDiscoveryDocumentAndLogin(options: LoginOptions = null) {\r\n        return this.loadDiscoveryDocumentAndTryLogin(options).then(_ => {\r\n            if (!this.hasValidIdToken() || !this.hasValidAccessToken()) {\r\n                this.initImplicitFlow();\r\n                return false;\r\n            } else {\r\n                return true;\r\n            }\r\n        });\r\n    }\r\n\r\n    private debug(...args): void {\r\n        if (this.showDebugInformation) {\r\n            console.debug.apply(console, args);\r\n        }\r\n    }\r\n\r\n    private validateUrlFromDiscoveryDocument(url: string): string[] {\r\n        const errors: string[] = [];\r\n        const httpsCheck = this.validateUrlForHttps(url);\r\n        const issuerCheck = this.validateUrlAgainstIssuer(url);\r\n\r\n        if (!httpsCheck) {\r\n            errors.push(\r\n                'https for all urls required. Also for urls received by discovery.'\r\n            );\r\n        }\r\n\r\n        if (!issuerCheck) {\r\n            errors.push(\r\n                'Every url in discovery document has to start with the issuer url.' +\r\n                'Also see property strictDiscoveryDocumentValidation.'\r\n            );\r\n        }\r\n\r\n        return errors;\r\n    }\r\n\r\n    private validateUrlForHttps(url: string): boolean {\r\n        if (!url) {\r\n            return true;\r\n        }\r\n\r\n        const lcUrl = url.toLowerCase();\r\n\r\n        if (this.requireHttps === false) {\r\n            return true;\r\n        }\r\n\r\n        if (\r\n            (lcUrl.match(/^http:\\/\\/localhost($|[:\\/])/) ||\r\n                lcUrl.match(/^http:\\/\\/localhost($|[:\\/])/)) &&\r\n            this.requireHttps === 'remoteOnly'\r\n        ) {\r\n            return true;\r\n        }\r\n\r\n        return lcUrl.startsWith('https://');\r\n    }\r\n\r\n    private validateUrlAgainstIssuer(url: string) {\r\n        if (!this.strictDiscoveryDocumentValidation) {\r\n            return true;\r\n        }\r\n        if (!url) {\r\n            return true;\r\n        }\r\n        return url.toLowerCase().startsWith(this.issuer.toLowerCase());\r\n    }\r\n\r\n    private setupRefreshTimer(): void {\r\n        if (typeof window === 'undefined') {\r\n            this.debug('timer not supported on this plattform');\r\n            return;\r\n        }\r\n\r\n        if (this.hasValidIdToken()) {\r\n            this.clearAccessTokenTimer();\r\n            this.clearIdTokenTimer();\r\n            this.setupExpirationTimers();\r\n        }\r\n\r\n        this.events.pipe(filter(e => e.type === 'token_received')).subscribe(_ => {\r\n            this.clearAccessTokenTimer();\r\n            this.clearIdTokenTimer();\r\n            this.setupExpirationTimers();\r\n        });\r\n    }\r\n\r\n    private setupExpirationTimers(): void {\r\n        const idTokenExp = this.getIdTokenExpiration() || Number.MAX_VALUE;\r\n        const accessTokenExp = this.getAccessTokenExpiration() || Number.MAX_VALUE;\r\n        const useAccessTokenExp = accessTokenExp <= idTokenExp;\r\n\r\n        if (this.hasValidAccessToken() && useAccessTokenExp) {\r\n            this.setupAccessTokenTimer();\r\n        }\r\n\r\n        if (this.hasValidIdToken() && !useAccessTokenExp) {\r\n            this.setupIdTokenTimer();\r\n        }\r\n    }\r\n\r\n    private setupAccessTokenTimer(): void {\r\n        const expiration = this.getAccessTokenExpiration();\r\n        const storedAt = this.getAccessTokenStoredAt();\r\n        const timeout = this.calcTimeout(storedAt, expiration);\r\n\r\n        this.ngZone.runOutsideAngular(() => {\r\n            this.accessTokenTimeoutSubscription = of(\r\n                new OAuthInfoEvent('token_expires', 'access_token')\r\n            )\r\n                .pipe(delay(timeout))\r\n                .subscribe(e => {\r\n                    this.ngZone.run(() => {\r\n                        this.eventsSubject.next(e);\r\n                    });\r\n                });\r\n        });\r\n    }\r\n\r\n    private setupIdTokenTimer(): void {\r\n        const expiration = this.getIdTokenExpiration();\r\n        const storedAt = this.getIdTokenStoredAt();\r\n        const timeout = this.calcTimeout(storedAt, expiration);\r\n\r\n        this.ngZone.runOutsideAngular(() => {\r\n            this.idTokenTimeoutSubscription = of(\r\n                new OAuthInfoEvent('token_expires', 'id_token')\r\n            )\r\n                .pipe(delay(timeout))\r\n                .subscribe(e => {\r\n                    this.ngZone.run(() => {\r\n                        this.eventsSubject.next(e);\r\n                    });\r\n                });\r\n        });\r\n    }\r\n\r\n    private clearAccessTokenTimer(): void {\r\n        if (this.accessTokenTimeoutSubscription) {\r\n            this.accessTokenTimeoutSubscription.unsubscribe();\r\n        }\r\n    }\r\n\r\n    private clearIdTokenTimer(): void {\r\n        if (this.idTokenTimeoutSubscription) {\r\n            this.idTokenTimeoutSubscription.unsubscribe();\r\n        }\r\n    }\r\n\r\n    private calcTimeout(storedAt: number, expiration: number): number {\r\n        const delta = (expiration - storedAt) * this.timeoutFactor;\r\n        return delta;\r\n    }\r\n\r\n    /**\r\n     * DEPRECATED. Use a provider for OAuthStorage instead:\r\n     * \r\n     * { provide: OAuthStorage, useValue: localStorage }\r\n     * \r\n     * Sets a custom storage used to store the received\r\n     * tokens on client side. By default, the browser's\r\n     * sessionStorage is used.\r\n     * @ignore\r\n     * \r\n     * @param storage\r\n     */\r\n    public setStorage(storage: OAuthStorage): void {\r\n        this._storage = storage;\r\n        this.configChanged();\r\n    }\r\n\r\n    /**\r\n     * Loads the discovery document to configure most\r\n     * properties of this service. The url of the discovery\r\n     * document is infered from the issuer's url according\r\n     * to the OpenId Connect spec. To use another url you\r\n     * can pass it to to optional parameter fullUrl.\r\n     *\r\n     * @param fullUrl\r\n     */\r\n    public loadDiscoveryDocument(fullUrl: string = null): Promise<object> {\r\n        return new Promise((resolve, reject) => {\r\n            if (!fullUrl) {\r\n                fullUrl = this.issuer || '';\r\n                if (!fullUrl.endsWith('/')) {\r\n                    fullUrl += '/';\r\n                }\r\n                fullUrl += '.well-known/openid-configuration';\r\n            }\r\n\r\n            if (!this.validateUrlForHttps(fullUrl)) {\r\n                reject('issuer must use Https. Also check property requireHttps.');\r\n                return;\r\n            }\r\n\r\n            this.http.get<OidcDiscoveryDoc>(fullUrl).subscribe(\r\n                doc => {\r\n                    if (!this.validateDiscoveryDocument(doc)) {\r\n                        this.eventsSubject.next(\r\n                            new OAuthErrorEvent('discovery_document_validation_error', null)\r\n                        );\r\n                        reject('discovery_document_validation_error');\r\n                        return;\r\n                    }\r\n\r\n                    this.loginUrl = doc.authorization_endpoint;\r\n                    this.logoutUrl = doc.end_session_endpoint || this.logoutUrl;\r\n                    this.grantTypesSupported = doc.grant_types_supported;\r\n                    this.issuer = doc.issuer;\r\n                    this.tokenEndpoint = doc.token_endpoint;\r\n                    this.userinfoEndpoint = doc.userinfo_endpoint;\r\n                    this.jwksUri = doc.jwks_uri;\r\n                    this.sessionCheckIFrameUrl = doc.check_session_iframe || this.sessionCheckIFrameUrl;\r\n\r\n                    this.discoveryDocumentLoaded = true;\r\n                    this.discoveryDocumentLoadedSubject.next(doc);\r\n\r\n                    if (this.sessionChecksEnabled) {\r\n                        this.restartSessionChecksIfStillLoggedIn();\r\n                    }\r\n\r\n                    this.loadJwks()\r\n                        .then(jwks => {\r\n                            const result: object = {\r\n                                discoveryDocument: doc,\r\n                                jwks: jwks\r\n                            };\r\n\r\n                            const event = new OAuthSuccessEvent(\r\n                                'discovery_document_loaded',\r\n                                result\r\n                            );\r\n                            this.eventsSubject.next(event);\r\n                            resolve(event);\r\n                            return;\r\n                        })\r\n                        .catch(err => {\r\n                            this.eventsSubject.next(\r\n                                new OAuthErrorEvent('discovery_document_load_error', err)\r\n                            );\r\n                            reject(err);\r\n                            return;\r\n                        });\r\n                },\r\n                err => {\r\n                    console.error('error loading discovery document', err);\r\n                    this.eventsSubject.next(\r\n                        new OAuthErrorEvent('discovery_document_load_error', err)\r\n                    );\r\n                    reject(err);\r\n                }\r\n            );\r\n        });\r\n    }\r\n\r\n    private loadJwks(): Promise<object> {\r\n        return new Promise<object>((resolve, reject) => {\r\n            if (this.jwksUri) {\r\n                this.http.get(this.jwksUri).subscribe(\r\n                    jwks => {\r\n                        this.jwks = jwks;\r\n                        this.eventsSubject.next(\r\n                            new OAuthSuccessEvent('discovery_document_loaded')\r\n                        );\r\n                        resolve(jwks);\r\n                    },\r\n                    err => {\r\n                        console.error('error loading jwks', err);\r\n                        this.eventsSubject.next(\r\n                            new OAuthErrorEvent('jwks_load_error', err)\r\n                        );\r\n                        reject(err);\r\n                    }\r\n                );\r\n            } else {\r\n                resolve(null);\r\n            }\r\n        });\r\n    }\r\n\r\n    private validateDiscoveryDocument(doc: OidcDiscoveryDoc): boolean {\r\n        let errors: string[];\r\n\r\n        if (!this.skipIssuerCheck && doc.issuer !== this.issuer) {\r\n            console.error(\r\n                'invalid issuer in discovery document',\r\n                'expected: ' + this.issuer,\r\n                'current: ' + doc.issuer\r\n            );\r\n            return false;\r\n        }\r\n\r\n        errors = this.validateUrlFromDiscoveryDocument(doc.authorization_endpoint);\r\n        if (errors.length > 0) {\r\n            console.error(\r\n                'error validating authorization_endpoint in discovery document',\r\n                errors\r\n            );\r\n            return false;\r\n        }\r\n\r\n        errors = this.validateUrlFromDiscoveryDocument(doc.end_session_endpoint);\r\n        if (errors.length > 0) {\r\n            console.error(\r\n                'error validating end_session_endpoint in discovery document',\r\n                errors\r\n            );\r\n            return false;\r\n        }\r\n\r\n        errors = this.validateUrlFromDiscoveryDocument(doc.token_endpoint);\r\n        if (errors.length > 0) {\r\n            console.error(\r\n                'error validating token_endpoint in discovery document',\r\n                errors\r\n            );\r\n        }\r\n\r\n        errors = this.validateUrlFromDiscoveryDocument(doc.userinfo_endpoint);\r\n        if (errors.length > 0) {\r\n            console.error(\r\n                'error validating userinfo_endpoint in discovery document',\r\n                errors\r\n            );\r\n            return false;\r\n        }\r\n\r\n        errors = this.validateUrlFromDiscoveryDocument(doc.jwks_uri);\r\n        if (errors.length > 0) {\r\n            console.error('error validating jwks_uri in discovery document', errors);\r\n            return false;\r\n        }\r\n\r\n        if (this.sessionChecksEnabled && !doc.check_session_iframe) {\r\n            console.warn(\r\n                'sessionChecksEnabled is activated but discovery document' +\r\n                ' does not contain a check_session_iframe field'\r\n            );\r\n        }\r\n\r\n        // this.sessionChecksEnabled = !!doc.check_session_iframe;\r\n\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * Uses password flow to exchange userName and password for an\r\n     * access_token. After receiving the access_token, this method\r\n     * uses it to query the userinfo endpoint in order to get information\r\n     * about the user in question.\r\n     *\r\n     * When using this, make sure that the property oidc is set to false.\r\n     * Otherwise stricter validations take happen that makes this operation\r\n     * fail.\r\n     *\r\n     * @param userName\r\n     * @param password\r\n     * @param headers Optional additional http-headers.\r\n     */\r\n    public fetchTokenUsingPasswordFlowAndLoadUserProfile(\r\n        userName: string,\r\n        password: string,\r\n        headers: HttpHeaders = new HttpHeaders()\r\n    ): Promise<object> {\r\n        return this.fetchTokenUsingPasswordFlow(userName, password, headers).then(\r\n            () => this.loadUserProfile()\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Loads the user profile by accessing the user info endpoint defined by OpenId Connect.\r\n     *\r\n     * When using this with OAuth2 password flow, make sure that the property oidc is set to false.\r\n     * Otherwise stricter validations take happen that makes this operation\r\n     * fail.\r\n     */\r\n    public loadUserProfile(): Promise<object> {\r\n        if (!this.hasValidAccessToken()) {\r\n            throw new Error('Can not load User Profile without access_token');\r\n        }\r\n        if (!this.validateUrlForHttps(this.userinfoEndpoint)) {\r\n            throw new Error(\r\n                'userinfoEndpoint must use Http. Also check property requireHttps.'\r\n            );\r\n        }\r\n\r\n        return new Promise((resolve, reject) => {\r\n            const headers = new HttpHeaders().set(\r\n                'Authorization',\r\n                'Bearer ' + this.getAccessToken()\r\n            );\r\n\r\n            this.http.get<UserInfo>(this.userinfoEndpoint, { headers }).subscribe(\r\n                info => {\r\n                    this.debug('userinfo received', info);\r\n\r\n                    const existingClaims = this.getIdentityClaims() || {};\r\n\r\n                    if (!this.skipSubjectCheck) {\r\n                        if (\r\n                            this.oidc &&\r\n                            (!existingClaims['sub'] || info.sub !== existingClaims['sub'])\r\n                        ) {\r\n                            const err =\r\n                                'if property oidc is true, the received user-id (sub) has to be the user-id ' +\r\n                                'of the user that has logged in with oidc.\\n' +\r\n                                'if you are not using oidc but just oauth2 password flow set oidc to false';\r\n\r\n                            reject(err);\r\n                            return;\r\n                        }\r\n                    }\r\n\r\n                    info = Object.assign({}, existingClaims, info);\r\n\r\n                    this._storage.setItem('id_token_claims_obj', JSON.stringify(info));\r\n                    this.eventsSubject.next(new OAuthSuccessEvent('user_profile_loaded'));\r\n                    resolve(info);\r\n                },\r\n                err => {\r\n                    console.error('error loading user info', err);\r\n                    this.eventsSubject.next(\r\n                        new OAuthErrorEvent('user_profile_load_error', err)\r\n                    );\r\n                    reject(err);\r\n                }\r\n            );\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Uses password flow to exchange userName and password for an access_token.\r\n     * @param userName\r\n     * @param password\r\n     * @param headers Optional additional http-headers.\r\n     */\r\n    public fetchTokenUsingPasswordFlow(\r\n        userName: string,\r\n        password: string,\r\n        headers: HttpHeaders = new HttpHeaders()\r\n    ): Promise<object> {\r\n        if (!this.validateUrlForHttps(this.tokenEndpoint)) {\r\n            throw new Error(\r\n                'tokenEndpoint must use Http. Also check property requireHttps.'\r\n            );\r\n        }\r\n\r\n        return new Promise((resolve, reject) => {\r\n            /**\r\n             * A `HttpParameterCodec` that uses `encodeURIComponent` and `decodeURIComponent` to\r\n             * serialize and parse URL parameter keys and values.\r\n             *\r\n             * @stable\r\n             */\r\n            let params = new HttpParams({ encoder: new WebHttpUrlEncodingCodec() })\r\n                .set('grant_type', 'password')\r\n                .set('scope', this.scope)\r\n                .set('username', userName)\r\n                .set('password', password);\r\n\r\n            if (this.useHttpBasicAuthForPasswordFlow) {\r\n                const header = btoa(`${this.clientId}:${this.dummyClientSecret}`);\r\n                headers = headers.set(\r\n                    'Authentication',\r\n                    'BASIC ' + header);\r\n            }\r\n\r\n            if (!this.useHttpBasicAuthForPasswordFlow) {\r\n                params = params.set('client_id', this.clientId);\r\n            }\r\n\r\n            if (!this.useHttpBasicAuthForPasswordFlow && this.dummyClientSecret) {\r\n                params = params.set('client_secret', this.dummyClientSecret);\r\n            }\r\n\r\n            if (this.customQueryParams) {\r\n                for (const key of Object.getOwnPropertyNames(this.customQueryParams)) {\r\n                    params = params.set(key, this.customQueryParams[key]);\r\n                }\r\n            }\r\n\r\n            headers = headers.set(\r\n                'Content-Type',\r\n                'application/x-www-form-urlencoded'\r\n            );\r\n\r\n            this.http\r\n                .post<TokenResponse>(this.tokenEndpoint, params, { headers })\r\n                .subscribe(\r\n                    tokenResponse => {\r\n                        this.debug('tokenResponse', tokenResponse);\r\n                        this.storeAccessTokenResponse(\r\n                            tokenResponse.access_token,\r\n                            tokenResponse.refresh_token,\r\n                            tokenResponse.expires_in,\r\n                            tokenResponse.scope\r\n                        );\r\n\r\n                        this.eventsSubject.next(new OAuthSuccessEvent('token_received'));\r\n                        resolve(tokenResponse);\r\n                    },\r\n                    err => {\r\n                        console.error('Error performing password flow', err);\r\n                        this.eventsSubject.next(new OAuthErrorEvent('token_error', err));\r\n                        reject(err);\r\n                    }\r\n                );\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Refreshes the token using a refresh_token.\r\n     * This does not work for implicit flow, b/c\r\n     * there is no refresh_token in this flow.\r\n     * A solution for this is provided by the\r\n     * method silentRefresh.\r\n     */\r\n    public refreshToken(): Promise<object> {\r\n        if (!this.validateUrlForHttps(this.tokenEndpoint)) {\r\n            throw new Error(\r\n                'tokenEndpoint must use Http. Also check property requireHttps.'\r\n            );\r\n        }\r\n\r\n        return new Promise((resolve, reject) => {\r\n            let params = new HttpParams()\r\n                .set('grant_type', 'refresh_token')\r\n                .set('client_id', this.clientId)\r\n                .set('scope', this.scope)\r\n                .set('refresh_token', this._storage.getItem('refresh_token'));\r\n\r\n            if (this.dummyClientSecret) {\r\n                params = params.set('client_secret', this.dummyClientSecret);\r\n            }\r\n\r\n            if (this.customQueryParams) {\r\n                for (const key of Object.getOwnPropertyNames(this.customQueryParams)) {\r\n                    params = params.set(key, this.customQueryParams[key]);\r\n                }\r\n            }\r\n\r\n            const headers = new HttpHeaders().set(\r\n                'Content-Type',\r\n                'application/x-www-form-urlencoded'\r\n            );\r\n\r\n            this.http\r\n                .post<TokenResponse>(this.tokenEndpoint, params, { headers })\r\n                .subscribe(\r\n                    tokenResponse => {\r\n                        this.debug('refresh tokenResponse', tokenResponse);\r\n                        this.storeAccessTokenResponse(\r\n                            tokenResponse.access_token,\r\n                            tokenResponse.refresh_token,\r\n                            tokenResponse.expires_in,\r\n                            tokenResponse.scope\r\n                        );\r\n\r\n                        this.eventsSubject.next(new OAuthSuccessEvent('token_received'));\r\n                        this.eventsSubject.next(new OAuthSuccessEvent('token_refreshed'));\r\n                        resolve(tokenResponse);\r\n                    },\r\n                    err => {\r\n                        console.error('Error performing password flow', err);\r\n                        this.eventsSubject.next(\r\n                            new OAuthErrorEvent('token_refresh_error', err)\r\n                        );\r\n                        reject(err);\r\n                    }\r\n                );\r\n        });\r\n    }\r\n\r\n    private removeSilentRefreshEventListener(): void {\r\n        if (this.silentRefreshPostMessageEventListener) {\r\n            window.removeEventListener(\r\n                'message',\r\n                this.silentRefreshPostMessageEventListener\r\n            );\r\n            this.silentRefreshPostMessageEventListener = null;\r\n        }\r\n    }\r\n\r\n    private setupSilentRefreshEventListener(): void {\r\n        this.removeSilentRefreshEventListener();\r\n\r\n        this.silentRefreshPostMessageEventListener = (e: MessageEvent) => {\r\n            let expectedPrefix = '#';\r\n\r\n            if (this.silentRefreshMessagePrefix) {\r\n                expectedPrefix += this.silentRefreshMessagePrefix;\r\n            }\r\n\r\n            if (!e || !e.data || typeof e.data !== 'string') {\r\n                return;\r\n            }\r\n\r\n            const prefixedMessage: string = e.data;\r\n\r\n            if (!prefixedMessage.startsWith(expectedPrefix)) {\r\n                return;\r\n            }\r\n\r\n            const message = '#' + prefixedMessage.substr(expectedPrefix.length);\r\n\r\n            this.tryLogin({\r\n                customHashFragment: message,\r\n                preventClearHashAfterLogin: true,\r\n                onLoginError: err => {\r\n                    this.eventsSubject.next(\r\n                        new OAuthErrorEvent('silent_refresh_error', err)\r\n                    );\r\n                },\r\n                onTokenReceived: () => {\r\n                    this.eventsSubject.next(new OAuthSuccessEvent('silently_refreshed'));\r\n                }\r\n            }).catch(err => this.debug('tryLogin during silent refresh failed', err));\r\n        };\r\n\r\n        window.addEventListener(\r\n            'message',\r\n            this.silentRefreshPostMessageEventListener\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Performs a silent refresh for implicit flow.\r\n     * Use this method to get a new tokens when/ before\r\n     * the existing tokens expires.\r\n     */\r\n    public silentRefresh(params: object = {}, noPrompt = true): Promise<OAuthEvent> {\r\n        const claims: object = this.getIdentityClaims() || {};\r\n\r\n        if (this.useIdTokenHintForSilentRefresh && this.hasValidIdToken()) {\r\n            params['id_token_hint'] = this.getIdToken();\r\n        }\r\n\r\n        /*\r\n            if (!claims) {\r\n                throw new Error('cannot perform a silent refresh as the user is not logged in');\r\n            }\r\n            */\r\n\r\n        if (!this.validateUrlForHttps(this.loginUrl)) {\r\n            throw new Error(\r\n                'tokenEndpoint must use Https. Also check property requireHttps.'\r\n            );\r\n        }\r\n\r\n        if (typeof document === 'undefined') {\r\n            throw new Error('silent refresh is not supported on this platform');\r\n        }\r\n\r\n        const existingIframe = document.getElementById(\r\n            this.silentRefreshIFrameName\r\n        );\r\n        if (existingIframe) {\r\n            document.body.removeChild(existingIframe);\r\n        }\r\n\r\n        this.silentRefreshSubject = claims['sub'];\r\n\r\n        const iframe = document.createElement('iframe');\r\n        iframe.id = this.silentRefreshIFrameName;\r\n\r\n        this.setupSilentRefreshEventListener();\r\n\r\n        const redirectUri = this.silentRefreshRedirectUri || this.redirectUri;\r\n        this.createLoginUrl(null, null, redirectUri, noPrompt, params).then(url => {\r\n            iframe.setAttribute('src', url);\r\n            \r\n            if (!this.silentRefreshShowIFrame) {\r\n                iframe.style['display'] = 'none';\r\n            }\r\n            document.body.appendChild(iframe);\r\n        });\r\n\r\n        const errors = this.events.pipe(\r\n            filter(e => e instanceof OAuthErrorEvent),\r\n            first()\r\n        );\r\n        const success = this.events.pipe(\r\n            filter(e => e.type === 'silently_refreshed'),\r\n            first()\r\n        );\r\n        const timeout = of(\r\n            new OAuthErrorEvent('silent_refresh_timeout', null)\r\n        ).pipe(delay(this.silentRefreshTimeout));\r\n\r\n        return race([errors, success, timeout])\r\n            .pipe(\r\n                tap(e => {\r\n                    if (e.type === 'silent_refresh_timeout') {\r\n                        this.eventsSubject.next(e);\r\n                    }\r\n                }),\r\n                map(e => {\r\n                    if (e instanceof OAuthErrorEvent) {\r\n                        throw e;\r\n                    }\r\n                    return e;\r\n                })\r\n            )\r\n            .toPromise();\r\n    }\r\n\r\n    private canPerformSessionCheck(): boolean {\r\n        if (!this.sessionChecksEnabled) {\r\n            return false;\r\n        }\r\n        if (!this.sessionCheckIFrameUrl) {\r\n            console.warn(\r\n                'sessionChecksEnabled is activated but there ' +\r\n                'is no sessionCheckIFrameUrl'\r\n            );\r\n            return false;\r\n        }\r\n        const sessionState = this.getSessionState();\r\n        if (!sessionState) {\r\n            console.warn(\r\n                'sessionChecksEnabled is activated but there ' + 'is no session_state'\r\n            );\r\n            return false;\r\n        }\r\n        if (typeof document === 'undefined') {\r\n            return false;\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    private setupSessionCheckEventListener(): void {\r\n        this.removeSessionCheckEventListener();\r\n\r\n        this.sessionCheckEventListener = (e: MessageEvent) => {\r\n            const origin = e.origin.toLowerCase();\r\n            const issuer = this.issuer.toLowerCase();\r\n\r\n            this.debug('sessionCheckEventListener');\r\n\r\n            if (!issuer.startsWith(origin)) {\r\n                this.debug(\r\n                    'sessionCheckEventListener',\r\n                    'wrong origin',\r\n                    origin,\r\n                    'expected',\r\n                    issuer\r\n                );\r\n            }\r\n\r\n            switch (e.data) {\r\n                case 'unchanged':\r\n                    this.handleSessionUnchanged();\r\n                    break;\r\n                case 'changed':\r\n                    this.handleSessionChange();\r\n                    break;\r\n                case 'error':\r\n                    this.handleSessionError();\r\n                    break;\r\n            }\r\n\r\n            this.debug('got info from session check inframe', e);\r\n        };\r\n\r\n        window.addEventListener('message', this.sessionCheckEventListener);\r\n    }\r\n\r\n    private handleSessionUnchanged(): void {\r\n        this.debug('session check', 'session unchanged');\r\n    }\r\n\r\n    private handleSessionChange(): void {\r\n        /* events: session_changed, relogin, stopTimer, logged_out*/\r\n        this.eventsSubject.next(new OAuthInfoEvent('session_changed'));\r\n        this.stopSessionCheckTimer();\r\n        if (this.silentRefreshRedirectUri) {\r\n            this.silentRefresh().catch(_ =>\r\n                this.debug('silent refresh failed after session changed')\r\n            );\r\n            this.waitForSilentRefreshAfterSessionChange();\r\n        } else {\r\n            this.eventsSubject.next(new OAuthInfoEvent('session_terminated'));\r\n            this.logOut(true);\r\n        }\r\n    }\r\n\r\n    private waitForSilentRefreshAfterSessionChange() {\r\n        this.events\r\n            .pipe(\r\n                filter(\r\n                    (e: OAuthEvent) =>\r\n                        e.type === 'silently_refreshed' ||\r\n                        e.type === 'silent_refresh_timeout' ||\r\n                        e.type === 'silent_refresh_error'\r\n                ),\r\n                first()\r\n            )\r\n            .subscribe(e => {\r\n                if (e.type !== 'silently_refreshed') {\r\n                    this.debug('silent refresh did not work after session changed');\r\n                    this.eventsSubject.next(new OAuthInfoEvent('session_terminated'));\r\n                    this.logOut(true);\r\n                }\r\n            });\r\n    }\r\n\r\n    private handleSessionError(): void {\r\n        this.stopSessionCheckTimer();\r\n        this.eventsSubject.next(new OAuthInfoEvent('session_error'));\r\n    }\r\n\r\n    private removeSessionCheckEventListener(): void {\r\n        if (this.sessionCheckEventListener) {\r\n            window.removeEventListener('message', this.sessionCheckEventListener);\r\n            this.sessionCheckEventListener = null;\r\n        }\r\n    }\r\n\r\n    private initSessionCheck(): void {\r\n        if (!this.canPerformSessionCheck()) {\r\n            return;\r\n        }\r\n\r\n        const existingIframe = document.getElementById(this.sessionCheckIFrameName);\r\n        if (existingIframe) {\r\n            document.body.removeChild(existingIframe);\r\n        }\r\n\r\n        const iframe = document.createElement('iframe');\r\n        iframe.id = this.sessionCheckIFrameName;\r\n\r\n        this.setupSessionCheckEventListener();\r\n\r\n        const url = this.sessionCheckIFrameUrl;\r\n        iframe.setAttribute('src', url);\r\n        // iframe.style.visibility = 'hidden';\r\n        iframe.style.display = 'none';\r\n        document.body.appendChild(iframe);\r\n\r\n        this.startSessionCheckTimer();\r\n    }\r\n\r\n    private startSessionCheckTimer(): void {\r\n        this.stopSessionCheckTimer();\r\n        this.sessionCheckTimer = setInterval(\r\n            this.checkSession.bind(this),\r\n            this.sessionCheckIntervall\r\n        );\r\n    }\r\n\r\n    private stopSessionCheckTimer(): void {\r\n        if (this.sessionCheckTimer) {\r\n            clearInterval(this.sessionCheckTimer);\r\n            this.sessionCheckTimer = null;\r\n        }\r\n    }\r\n\r\n    private checkSession(): void {\r\n        const iframe: any = document.getElementById(this.sessionCheckIFrameName);\r\n\r\n        if (!iframe) {\r\n            console.warn(\r\n                'checkSession did not find iframe',\r\n                this.sessionCheckIFrameName\r\n            );\r\n        }\r\n\r\n        const sessionState = this.getSessionState();\r\n\r\n        if (!sessionState) {\r\n            this.stopSessionCheckTimer();\r\n        }\r\n\r\n        const message = this.clientId + ' ' + sessionState;\r\n        iframe.contentWindow.postMessage(message, this.issuer);\r\n    }\r\n\r\n    private createLoginUrl(\r\n        state = '',\r\n        loginHint = '',\r\n        customRedirectUri = '',\r\n        noPrompt = false,\r\n        params: object = {}\r\n    ) {\r\n        const that = this;\r\n\r\n        let redirectUri: string;\r\n\r\n        if (customRedirectUri) {\r\n            redirectUri = customRedirectUri;\r\n        } else {\r\n            redirectUri = this.redirectUri;\r\n        }\r\n\r\n        return this.createAndSaveNonce().then((nonce: any) => {\r\n            if (state) {\r\n                state = nonce + this.config.nonceStateSeparator + state;\r\n            } else {\r\n                state = nonce;\r\n            }\r\n\r\n            if (!this.requestAccessToken && !this.oidc) {\r\n                throw new Error(\r\n                    'Either requestAccessToken or oidc or both must be true'\r\n                );\r\n            }\r\n\r\n            if (this.oidc && this.requestAccessToken) {\r\n                this.responseType = 'id_token token';\r\n            } else if (this.oidc && !this.requestAccessToken) {\r\n                this.responseType = 'id_token';\r\n            } else {\r\n                this.responseType = 'token';\r\n            }\r\n\r\n            const seperationChar = that.loginUrl.indexOf('?') > -1 ? '&' : '?';\r\n\r\n            let scope = that.scope;\r\n\r\n            if (this.oidc && !scope.match(/(^|\\s)openid($|\\s)/)) {\r\n                scope = 'openid ' + scope;\r\n            }\r\n\r\n            let url =\r\n                that.loginUrl +\r\n                seperationChar +\r\n                'response_type=' +\r\n                encodeURIComponent(that.responseType) +\r\n                '&client_id=' +\r\n                encodeURIComponent(that.clientId) +\r\n                '&state=' +\r\n                encodeURIComponent(state) +\r\n                '&redirect_uri=' +\r\n                encodeURIComponent(redirectUri) +\r\n                '&scope=' +\r\n                encodeURIComponent(scope);\r\n\r\n            if (loginHint) {\r\n                url += '&login_hint=' + encodeURIComponent(loginHint);\r\n            }\r\n\r\n            if (that.resource) {\r\n                url += '&resource=' + encodeURIComponent(that.resource);\r\n            }\r\n\r\n            if (that.oidc) {\r\n                url += '&nonce=' + encodeURIComponent(nonce);\r\n            }\r\n\r\n            if (noPrompt) {\r\n                url += '&prompt=none';\r\n            }\r\n\r\n            for (const key of Object.keys(params)) {\r\n                url +=\r\n                    '&' + encodeURIComponent(key) + '=' + encodeURIComponent(params[key]);\r\n            }\r\n\r\n            if (this.customQueryParams) {\r\n                for (const key of Object.getOwnPropertyNames(this.customQueryParams)) {\r\n                    url +=\r\n                        '&' + key + '=' + encodeURIComponent(this.customQueryParams[key]);\r\n                }\r\n            }\r\n\r\n            return url;\r\n        });\r\n    }\r\n\r\n    initImplicitFlowInternal(\r\n        additionalState = '',\r\n        params: string | object = ''\r\n    ): void {\r\n        if (this.inImplicitFlow) {\r\n            return;\r\n        }\r\n\r\n        this.inImplicitFlow = true;\r\n\r\n        if (!this.validateUrlForHttps(this.loginUrl)) {\r\n            throw new Error(\r\n                'loginUrl must use Http. Also check property requireHttps.'\r\n            );\r\n        }\r\n\r\n        let addParams: object = {};\r\n        let loginHint: string = null;\r\n\r\n        if (typeof params === 'string') {\r\n            loginHint = params;\r\n        } else if (typeof params === 'object') {\r\n            addParams = params;\r\n        }\r\n\r\n        this.createLoginUrl(additionalState, loginHint, null, false, addParams)\r\n            .then(function (url) {\r\n                location.href = url;\r\n            })\r\n            .catch(error => {\r\n                console.error('Error in initImplicitFlow');\r\n                console.error(error);\r\n                this.inImplicitFlow = false;\r\n            });\r\n    }\r\n\r\n    /**\r\n     * Starts the implicit flow and redirects to user to\r\n     * the auth servers login url.\r\n     *\r\n     * @param additionalState Optinal state that is passes around.\r\n     *  You find this state in the property ``state`` after ``tryLogin`` logged in the user.\r\n     * @param params Hash with additional parameter. If it is a string, it is used for the\r\n     *               parameter loginHint (for the sake of compatibility with former versions)\r\n     */\r\n    public initImplicitFlow(\r\n        additionalState = '',\r\n        params: string | object = ''\r\n    ): void {\r\n        if (this.loginUrl !== '') {\r\n            this.initImplicitFlowInternal(additionalState, params);\r\n        } else {\r\n            this.events\r\n                .pipe(filter(e => e.type === 'discovery_document_loaded'))\r\n                .subscribe(_ => this.initImplicitFlowInternal(additionalState, params));\r\n        }\r\n    }\r\n\r\n    private callOnTokenReceivedIfExists(options: LoginOptions): void {\r\n        const that = this;\r\n        if (options.onTokenReceived) {\r\n            const tokenParams = {\r\n                idClaims: that.getIdentityClaims(),\r\n                idToken: that.getIdToken(),\r\n                accessToken: that.getAccessToken(),\r\n                state: that.state\r\n            };\r\n            options.onTokenReceived(tokenParams);\r\n        }\r\n    }\r\n\r\n    private storeAccessTokenResponse(\r\n        accessToken: string,\r\n        refreshToken: string,\r\n        expiresIn: number,\r\n        grantedScopes: String\r\n    ): void {\r\n        this._storage.setItem('access_token', accessToken);\r\n        if (grantedScopes) {\r\n            this._storage.setItem('granted_scopes', JSON.stringify(grantedScopes.split('+')));\r\n        }\r\n        this._storage.setItem('access_token_stored_at', '' + Date.now());\r\n        if (expiresIn) {\r\n            const expiresInMilliSeconds = expiresIn * 1000;\r\n            const now = new Date();\r\n            const expiresAt = now.getTime() + expiresInMilliSeconds;\r\n            this._storage.setItem('expires_at', '' + expiresAt);\r\n        }\r\n\r\n        if (refreshToken) {\r\n            this._storage.setItem('refresh_token', refreshToken);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Checks whether there are tokens in the hash fragment\r\n     * as a result of the implicit flow. These tokens are\r\n     * parsed, validated and used to sign the user in to the\r\n     * current client.\r\n     *\r\n     * @param options Optinal options.\r\n     */\r\n    public tryLogin(options: LoginOptions = null): Promise<void> {\r\n        options = options || {};\r\n\r\n        let parts: object;\r\n\r\n        if (options.customHashFragment) {\r\n            parts = this.urlHelper.getHashFragmentParams(options.customHashFragment);\r\n        } else {\r\n            parts = this.urlHelper.getHashFragmentParams();\r\n        }\r\n\r\n        this.debug('parsed url', parts);\r\n\r\n        const state = parts['state'];\r\n        let nonceInState = state;\r\n\r\n        if (state) {\r\n            const idx = state.indexOf(this.config.nonceStateSeparator);\r\n\r\n            if (idx > -1) {\r\n                nonceInState = state.substr(0, idx);\r\n                this.state = state.substr(idx + this.config.nonceStateSeparator.length);\r\n            }\r\n        }\r\n\r\n        if (parts['error']) {\r\n            this.debug('error trying to login');\r\n            this.handleLoginError(options, parts);\r\n            const err = new OAuthErrorEvent('token_error', {}, parts);\r\n            this.eventsSubject.next(err);\r\n            return Promise.reject(err);\r\n        }\r\n\r\n        const accessToken = parts['access_token'];\r\n        const idToken = parts['id_token'];\r\n        const sessionState = parts['session_state'];\r\n        const grantedScopes = parts['scope'];\r\n\r\n        if (!this.requestAccessToken && !this.oidc) {\r\n            return Promise.reject(\r\n                'Either requestAccessToken or oidc or both must be true.'\r\n            );\r\n        }\r\n\r\n        if (this.requestAccessToken && !accessToken) {\r\n            return Promise.resolve();\r\n        }\r\n        if (this.requestAccessToken && !options.disableOAuth2StateCheck && !state) {\r\n            return Promise.resolve();\r\n        }\r\n        if (this.oidc && !idToken) {\r\n            return Promise.resolve();\r\n        }\r\n\r\n        if (this.sessionChecksEnabled && !sessionState) {\r\n            console.warn(\r\n                'session checks (Session Status Change Notification) ' +\r\n                'is activated in the configuration but the id_token ' +\r\n                'does not contain a session_state claim'\r\n            );\r\n        }\r\n\r\n        if (this.requestAccessToken && !options.disableOAuth2StateCheck) {\r\n            const success = this.validateNonceForAccessToken(\r\n                accessToken,\r\n                nonceInState\r\n            );\r\n            if (!success) {\r\n                const event = new OAuthErrorEvent('invalid_nonce_in_state', null);\r\n                this.eventsSubject.next(event);\r\n                return Promise.reject(event);\r\n            }\r\n        }\r\n\r\n        if (this.requestAccessToken) {\r\n            this.storeAccessTokenResponse(\r\n                accessToken,\r\n                null,\r\n                parts['expires_in'] || this.fallbackAccessTokenExpirationTimeInSec,\r\n                grantedScopes\r\n            );\r\n        }\r\n\r\n        if (!this.oidc) {\r\n            this.eventsSubject.next(new OAuthSuccessEvent('token_received'));\r\n            if (this.clearHashAfterLogin && !options.preventClearHashAfterLogin) {\r\n                location.hash = '';\r\n            }\r\n            return Promise.resolve();\r\n        }\r\n\r\n        return this.processIdToken(idToken, accessToken)\r\n            .then(result => {\r\n                if (options.validationHandler) {\r\n                    return options\r\n                        .validationHandler({\r\n                            accessToken: accessToken,\r\n                            idClaims: result.idTokenClaims,\r\n                            idToken: result.idToken,\r\n                            state: state\r\n                        })\r\n                        .then(_ => result);\r\n                }\r\n                return result;\r\n            })\r\n            .then(result => {\r\n                this.storeIdToken(result);\r\n                this.storeSessionState(sessionState);\r\n                if (this.clearHashAfterLogin) {\r\n                    location.hash = '';\r\n                }\r\n                this.eventsSubject.next(new OAuthSuccessEvent('token_received'));\r\n                this.callOnTokenReceivedIfExists(options);\r\n                this.inImplicitFlow = false;\r\n            })\r\n            .catch(reason => {\r\n                this.eventsSubject.next(\r\n                    new OAuthErrorEvent('token_validation_error', reason)\r\n                );\r\n                console.error('Error validating tokens');\r\n                console.error(reason);\r\n                return Promise.reject(reason);\r\n            });\r\n    }\r\n\r\n    private validateNonceForAccessToken(\r\n        accessToken: string,\r\n        nonceInState: string\r\n    ): boolean {\r\n        const savedNonce = this._storage.getItem('nonce');\r\n        if (savedNonce !== nonceInState) {\r\n            const err = 'validating access_token failed. wrong state/nonce.';\r\n            console.error(err, savedNonce, nonceInState);\r\n            return false;\r\n        }\r\n        return true;\r\n    }\r\n\r\n    protected storeIdToken(idToken: ParsedIdToken) {\r\n        this._storage.setItem('id_token', idToken.idToken);\r\n        this._storage.setItem('id_token_claims_obj', idToken.idTokenClaimsJson);\r\n        this._storage.setItem('id_token_expires_at', '' + idToken.idTokenExpiresAt);\r\n        this._storage.setItem('id_token_stored_at', '' + Date.now());\r\n    }\r\n\r\n    protected storeSessionState(sessionState: string): void {\r\n        this._storage.setItem('session_state', sessionState);\r\n    }\r\n\r\n    protected getSessionState(): string {\r\n        return this._storage.getItem('session_state');\r\n    }\r\n\r\n    private handleLoginError(options: LoginOptions, parts: object): void {\r\n        if (options.onLoginError) {\r\n            options.onLoginError(parts);\r\n        }\r\n        if (this.clearHashAfterLogin) {\r\n            location.hash = '';\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @ignore\r\n     */\r\n    public processIdToken(\r\n        idToken: string,\r\n        accessToken: string\r\n    ): Promise<ParsedIdToken> {\r\n        const tokenParts = idToken.split('.');\r\n        const headerBase64 = this.padBase64(tokenParts[0]);\r\n        const headerJson = b64DecodeUnicode(headerBase64);\r\n        const header = JSON.parse(headerJson);\r\n        const claimsBase64 = this.padBase64(tokenParts[1]);\r\n        const claimsJson = b64DecodeUnicode(claimsBase64);\r\n        const claims = JSON.parse(claimsJson);\r\n        const savedNonce = this._storage.getItem('nonce');\r\n\r\n        if (Array.isArray(claims.aud)) {\r\n            if (claims.aud.every(v => v !== this.clientId)) {\r\n                const err = 'Wrong audience: ' + claims.aud.join(',');\r\n                console.warn(err);\r\n                return Promise.reject(err);\r\n            }\r\n        } else {\r\n            if (claims.aud !== this.clientId) {\r\n                const err = 'Wrong audience: ' + claims.aud;\r\n                console.warn(err);\r\n                return Promise.reject(err);\r\n            }\r\n        }\r\n\r\n        /*\r\n            if (this.getKeyCount() > 1 && !header.kid) {\r\n                let err = 'There needs to be a kid property in the id_token header when multiple keys are defined via the property jwks';\r\n                console.warn(err);\r\n                return Promise.reject(err);\r\n            }\r\n            */\r\n\r\n        if (!claims.sub) {\r\n            const err = 'No sub claim in id_token';\r\n            console.warn(err);\r\n            return Promise.reject(err);\r\n        }\r\n\r\n        /* For now, we only check whether the sub against\r\n             * silentRefreshSubject when sessionChecksEnabled is on\r\n             * We will reconsider in a later version to do this\r\n             * in every other case too.\r\n             */\r\n        if (\r\n            this.sessionChecksEnabled &&\r\n            this.silentRefreshSubject &&\r\n            this.silentRefreshSubject !== claims['sub']\r\n        ) {\r\n            const err =\r\n                'After refreshing, we got an id_token for another user (sub). ' +\r\n                `Expected sub: ${this.silentRefreshSubject}, received sub: ${\r\n                claims['sub']\r\n                }`;\r\n\r\n            console.warn(err);\r\n            return Promise.reject(err);\r\n        }\r\n\r\n        if (!claims.iat) {\r\n            const err = 'No iat claim in id_token';\r\n            console.warn(err);\r\n            return Promise.reject(err);\r\n        }\r\n\r\n        if (claims.iss !== this.issuer) {\r\n            const err = 'Wrong issuer: ' + claims.iss;\r\n            console.warn(err);\r\n            return Promise.reject(err);\r\n        }\r\n\r\n        if (claims.nonce !== savedNonce) {\r\n            const err = 'Wrong nonce: ' + claims.nonce;\r\n            console.warn(err);\r\n            return Promise.reject(err);\r\n        }\r\n\r\n        if (\r\n            !this.disableAtHashCheck &&\r\n            this.requestAccessToken &&\r\n            !claims['at_hash']\r\n        ) {\r\n            const err = 'An at_hash is needed!';\r\n            console.warn(err);\r\n            return Promise.reject(err);\r\n        }\r\n\r\n        const now = Date.now();\r\n        const issuedAtMSec = claims.iat * 1000;\r\n        const expiresAtMSec = claims.exp * 1000;\r\n        const tenMinutesInMsec = 1000 * 60 * 10;\r\n\r\n        if (\r\n            issuedAtMSec - tenMinutesInMsec >= now ||\r\n            expiresAtMSec + tenMinutesInMsec <= now\r\n        ) {\r\n            const err = 'Token has been expired';\r\n            console.error(err);\r\n            console.error({\r\n                now: now,\r\n                issuedAtMSec: issuedAtMSec,\r\n                expiresAtMSec: expiresAtMSec\r\n            });\r\n            return Promise.reject(err);\r\n        }\r\n\r\n        const validationParams: ValidationParams = {\r\n            accessToken: accessToken,\r\n            idToken: idToken,\r\n            jwks: this.jwks,\r\n            idTokenClaims: claims,\r\n            idTokenHeader: header,\r\n            loadKeys: () => this.loadJwks()\r\n        };\r\n\r\n        if (\r\n            !this.disableAtHashCheck &&\r\n            this.requestAccessToken &&\r\n            !this.checkAtHash(validationParams)\r\n        ) {\r\n            const err = 'Wrong at_hash';\r\n            console.warn(err);\r\n            return Promise.reject(err);\r\n        }\r\n\r\n        return this.checkSignature(validationParams).then(_ => {\r\n            const result: ParsedIdToken = {\r\n                idToken: idToken,\r\n                idTokenClaims: claims,\r\n                idTokenClaimsJson: claimsJson,\r\n                idTokenHeader: header,\r\n                idTokenHeaderJson: headerJson,\r\n                idTokenExpiresAt: expiresAtMSec\r\n            };\r\n            return result;\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Returns the received claims about the user.\r\n     */\r\n    public getIdentityClaims(): object {\r\n        const claims = this._storage.getItem('id_token_claims_obj');\r\n        if (!claims) {\r\n            return null;\r\n        }\r\n        return JSON.parse(claims);\r\n    }\r\n\r\n    /**\r\n     * Returns the granted scopes from the server.\r\n     */\r\n    public getGrantedScopes(): object {\r\n        const scopes = this._storage.getItem('granted_scopes');\r\n        if (!scopes) {\r\n            return null;\r\n        }\r\n        return JSON.parse(scopes);\r\n    }\r\n\r\n    /**\r\n     * Returns the current id_token.\r\n     */\r\n    public getIdToken(): string {\r\n        return this._storage\r\n            ? this._storage.getItem('id_token')\r\n            : null;\r\n    }\r\n\r\n    private padBase64(base64data): string {\r\n        while (base64data.length % 4 !== 0) {\r\n            base64data += '=';\r\n        }\r\n        return base64data;\r\n    }\r\n\r\n    /**\r\n     * Returns the current access_token.\r\n     */\r\n    public getAccessToken(): string {\r\n        return this._storage.getItem('access_token');\r\n    }\r\n\r\n    public getRefreshToken(): string {\r\n        return this._storage.getItem('refresh_token');\r\n    }\r\n\r\n    /**\r\n     * Returns the expiration date of the access_token\r\n     * as milliseconds since 1970.\r\n     */\r\n    public getAccessTokenExpiration(): number {\r\n        if (!this._storage.getItem('expires_at')) {\r\n            return null;\r\n        }\r\n        return parseInt(this._storage.getItem('expires_at'), 10);\r\n    }\r\n\r\n    private getAccessTokenStoredAt(): number {\r\n        return parseInt(this._storage.getItem('access_token_stored_at'), 10);\r\n    }\r\n\r\n    private getIdTokenStoredAt(): number {\r\n        return parseInt(this._storage.getItem('id_token_stored_at'), 10);\r\n    }\r\n\r\n    /**\r\n     * Returns the expiration date of the id_token\r\n     * as milliseconds since 1970.\r\n     */\r\n    public getIdTokenExpiration(): number {\r\n        if (!this._storage.getItem('id_token_expires_at')) {\r\n            return null;\r\n        }\r\n\r\n        return parseInt(this._storage.getItem('id_token_expires_at'), 10);\r\n    }\r\n\r\n    /**\r\n     * Checkes, whether there is a valid access_token.\r\n     */\r\n    public hasValidAccessToken(): boolean {\r\n        if (this.getAccessToken()) {\r\n            const expiresAt = this._storage.getItem('expires_at');\r\n            const now = new Date();\r\n            if (expiresAt && parseInt(expiresAt, 10) < now.getTime()) {\r\n                return false;\r\n            }\r\n\r\n            return true;\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    /**\r\n     * Checkes, whether there is a valid id_token.\r\n     */\r\n    public hasValidIdToken(): boolean {\r\n        if (this.getIdToken()) {\r\n            const expiresAt = this._storage.getItem('id_token_expires_at');\r\n            const now = new Date();\r\n            if (expiresAt && parseInt(expiresAt, 10) < now.getTime()) {\r\n                return false;\r\n            }\r\n\r\n            return true;\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    /**\r\n     * Returns the auth-header that can be used\r\n     * to transmit the access_token to a service\r\n     */\r\n    public authorizationHeader(): string {\r\n        return 'Bearer ' + this.getAccessToken();\r\n    }\r\n\r\n    /**\r\n     * Removes all tokens and logs the user out.\r\n     * If a logout url is configured, the user is\r\n     * redirected to it.\r\n     * @param noRedirectToLogoutUrl\r\n     */\r\n    public logOut(noRedirectToLogoutUrl = false): void {\r\n        const id_token = this.getIdToken();\r\n        this._storage.removeItem('access_token');\r\n        this._storage.removeItem('id_token');\r\n        this._storage.removeItem('refresh_token');\r\n        this._storage.removeItem('nonce');\r\n        this._storage.removeItem('expires_at');\r\n        this._storage.removeItem('id_token_claims_obj');\r\n        this._storage.removeItem('id_token_expires_at');\r\n        this._storage.removeItem('id_token_stored_at');\r\n        this._storage.removeItem('access_token_stored_at');\r\n        this._storage.removeItem('granted_scopes');\r\n        this._storage.removeItem('session_state');\r\n\r\n        this.silentRefreshSubject = null;\r\n\r\n        this.eventsSubject.next(new OAuthInfoEvent('logout'));\r\n\r\n        if (!this.logoutUrl) {\r\n            return;\r\n        }\r\n        if (noRedirectToLogoutUrl) {\r\n            return;\r\n        }\r\n\r\n        if (!id_token && !this.postLogoutRedirectUri) {\r\n            return;\r\n        }\r\n\r\n        let logoutUrl: string;\r\n\r\n        if (!this.validateUrlForHttps(this.logoutUrl)) {\r\n            throw new Error(\r\n                'logoutUrl must use Http. Also check property requireHttps.'\r\n            );\r\n        }\r\n\r\n        // For backward compatibility\r\n        if (this.logoutUrl.indexOf('{{') > -1) {\r\n            logoutUrl = this.logoutUrl\r\n                .replace(/\\{\\{id_token\\}\\}/, id_token)\r\n                .replace(/\\{\\{client_id\\}\\}/, this.clientId);\r\n        } else {\r\n\r\n            let params = new HttpParams();\r\n\r\n            if (id_token) {\r\n                params = params.set('id_token_hint', id_token);\r\n            }\r\n\r\n            const postLogoutUrl = this.postLogoutRedirectUri || this.redirectUri;\r\n            if (postLogoutUrl) {\r\n                params = params.set('post_logout_redirect_uri', postLogoutUrl);\r\n            }\r\n\r\n            logoutUrl =\r\n                this.logoutUrl +\r\n                (this.logoutUrl.indexOf('?') > -1 ? '&' : '?') +\r\n                params.toString()\r\n        }\r\n        location.href = logoutUrl;\r\n    }\r\n\r\n    /**\r\n     * @ignore\r\n     */\r\n    public createAndSaveNonce(): Promise<string> {\r\n        const that = this;\r\n        return this.createNonce().then(function (nonce: any) {\r\n            that._storage.setItem('nonce', nonce);\r\n            return nonce;\r\n        });\r\n    }\r\n\r\n    protected createNonce(): Promise<string> {\r\n        return new Promise((resolve, reject) => {\r\n            if (this.rngUrl) {\r\n                throw new Error(\r\n                    'createNonce with rng-web-api has not been implemented so far'\r\n                );\r\n            } else {\r\n                let text = '';\r\n                const possible =\r\n                    'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\r\n\r\n                for (let i = 0; i < 40; i++) {\r\n                    text += possible.charAt(Math.floor(Math.random() * possible.length));\r\n                }\r\n\r\n                resolve(text);\r\n            }\r\n        });\r\n    }\r\n\r\n    private checkAtHash(params: ValidationParams): boolean {\r\n        if (!this.tokenValidationHandler) {\r\n            console.warn(\r\n                'No tokenValidationHandler configured. Cannot check at_hash.'\r\n            );\r\n            return true;\r\n        }\r\n        return this.tokenValidationHandler.validateAtHash(params);\r\n    }\r\n\r\n    private checkSignature(params: ValidationParams): Promise<any> {\r\n        if (!this.tokenValidationHandler) {\r\n            console.warn(\r\n                'No tokenValidationHandler configured. Cannot check signature.'\r\n            );\r\n            return Promise.resolve(null);\r\n        }\r\n        return this.tokenValidationHandler.validateSignature(params);\r\n    }\r\n}\r\n","export abstract class OAuthModuleConfig {\r\n  resourceServer: OAuthResourceServerConfig;\r\n}\r\n\r\nexport abstract class OAuthResourceServerConfig {\r\n  /**\r\n   * Urls for which calls should be intercepted.\r\n   * If there is an ResourceServerErrorHandler registered, it is used for them.\r\n   * If sendAccessToken is set to true, the access_token is send to them too.\r\n   */\r\n  allowedUrls?: Array<string>;\r\n  sendAccessToken: boolean;\r\n}\r\n","import { HttpResponse } from '@angular/common/http';\r\nimport { Observable, throwError } from 'rxjs';\r\n\r\nexport abstract class OAuthResourceServerErrorHandler {\r\n  abstract handleError(err: HttpResponse<any>): Observable<any>;\r\n}\r\n\r\nexport class OAuthNoopResourceServerErrorHandler\r\n  implements OAuthResourceServerErrorHandler {\r\n  handleError(err: HttpResponse<any>): Observable<any> {\r\n    return throwError(err);\r\n  }\r\n}\r\n","import { Injectable, Inject, Optional } from '@angular/core';\r\nimport { OAuthService } from '../oauth-service';\r\nimport { OAuthStorage } from '../types';\r\nimport {\r\n    HttpEvent,\r\n    HttpHandler,\r\n    HttpInterceptor,\r\n    HttpRequest,\r\n    HttpResponse,\r\n    HttpErrorResponse\r\n} from '@angular/common/http';\r\nimport { Observable } from 'rxjs';\r\nimport { catchError } from 'rxjs/operators';\r\nimport { OAuthResourceServerErrorHandler } from './resource-server-error-handler';\r\nimport { OAuthModuleConfig } from '../oauth-module.config';\r\n\r\n@Injectable()\r\nexport class DefaultOAuthInterceptor implements HttpInterceptor {\r\n    constructor(\r\n        private authStorage: OAuthStorage,\r\n        private errorHandler: OAuthResourceServerErrorHandler,\r\n        @Optional() private moduleConfig: OAuthModuleConfig\r\n    ) { }\r\n\r\n    private checkUrl(url: string): boolean {\r\n        const found = this.moduleConfig.resourceServer.allowedUrls.find(u => url.startsWith(u));\r\n        return !!found;\r\n    }\r\n\r\n    public intercept(\r\n        req: HttpRequest<any>,\r\n        next: HttpHandler\r\n    ): Observable<HttpEvent<any>> {\r\n        const url = req.url.toLowerCase();\r\n\r\n        if (!this.moduleConfig) {\r\n            return next.handle(req);\r\n        }\r\n        if (!this.moduleConfig.resourceServer) {\r\n            return next.handle(req);\r\n        }\r\n        if (this.moduleConfig.resourceServer.allowedUrls && !this.checkUrl(url)) {\r\n            return next.handle(req);\r\n        }\r\n\r\n        const sendAccessToken = this.moduleConfig.resourceServer.sendAccessToken;\r\n\r\n        if (sendAccessToken && this.authStorage.getItem('access_token')) {\r\n            const token = this.authStorage.getItem('access_token');\r\n            const header = 'Bearer ' + token;\r\n\r\n            const headers = req.headers.set('Authorization', header);\r\n\r\n            req = req.clone({ headers });\r\n        }\r\n\r\n        return next\r\n            .handle(req)\r\n            .pipe(catchError(err => this.errorHandler.handleError(err)));\r\n    }\r\n}\r\n","import { ValidationHandler, ValidationParams } from './validation-handler';\r\n\r\n/**\r\n * A validation handler that isn't validating nothing.\r\n * Can be used to skip validation (on your own risk).\r\n */\r\nexport class NullValidationHandler implements ValidationHandler {\r\n  validateSignature(validationParams: ValidationParams): Promise<any> {\r\n    return Promise.resolve(null);\r\n  }\r\n  validateAtHash(validationParams: ValidationParams): boolean {\r\n    return true;\r\n  }\r\n}\r\n","import { OAuthStorage } from './types';\r\nimport { NgModule, ModuleWithProviders } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { HTTP_INTERCEPTORS, HttpClientModule } from '@angular/common/http';\r\n\r\nimport { OAuthService } from './oauth-service';\r\nimport { UrlHelperService } from './url-helper.service';\r\n\r\nimport { OAuthModuleConfig } from './oauth-module.config';\r\nimport {\r\n  OAuthResourceServerErrorHandler,\r\n  OAuthNoopResourceServerErrorHandler\r\n} from './interceptors/resource-server-error-handler';\r\nimport { DefaultOAuthInterceptor } from './interceptors/default-oauth.interceptor';\r\nimport { ValidationHandler } from './token-validation/validation-handler';\r\nimport { NullValidationHandler } from './token-validation/null-validation-handler';\r\n\r\nexport function createDefaultStorage() {\r\n  return typeof sessionStorage !== 'undefined' ? sessionStorage : null;\r\n}\r\n\r\n@NgModule({\r\n  imports: [CommonModule],\r\n  declarations: [],\r\n  exports: []\r\n})\r\nexport class OAuthModule {\r\n  static forRoot(\r\n    config: OAuthModuleConfig = null,\r\n    validationHandlerClass = NullValidationHandler\r\n  ): ModuleWithProviders {\r\n    // const setupInterceptor = config && config.resourceServer && config.resourceServer.allowedUrls;\r\n\r\n    return {\r\n      ngModule: OAuthModule,\r\n      providers: [\r\n        OAuthService,\r\n        UrlHelperService,\r\n        { provide: OAuthStorage, useFactory: createDefaultStorage },\r\n        { provide: ValidationHandler, useClass: validationHandlerClass},\r\n        {\r\n          provide: OAuthResourceServerErrorHandler,\r\n          useClass: OAuthNoopResourceServerErrorHandler\r\n        },\r\n        { provide: OAuthModuleConfig, useValue: config },\r\n        {\r\n          provide: HTTP_INTERCEPTORS,\r\n          useClass: DefaultOAuthInterceptor,\r\n          multi: true\r\n        }\r\n      ]\r\n    };\r\n  }\r\n}\r\n","import {\r\n  AbstractValidationHandler,\r\n  ValidationParams\r\n} from './validation-handler';\r\n\r\n// declare var require: any;\r\n// let rs = require('jsrsasign');\r\n\r\nimport * as rs from 'jsrsasign';\r\n\r\n/**\r\n * Validates the signature of an id_token against one\r\n * of the keys of an JSON Web Key Set (jwks).\r\n *\r\n * This jwks can be provided by the discovery document.\r\n */\r\nexport class JwksValidationHandler extends AbstractValidationHandler {\r\n  /**\r\n   * Allowed algorithms\r\n   */\r\n  allowedAlgorithms: string[] = [\r\n    'HS256',\r\n    'HS384',\r\n    'HS512',\r\n    'RS256',\r\n    'RS384',\r\n    'RS512',\r\n    'ES256',\r\n    'ES384',\r\n    'PS256',\r\n    'PS384',\r\n    'PS512'\r\n  ];\r\n\r\n  /**\r\n   * Time period in seconds the timestamp in the signature can\r\n   * differ from the current time.\r\n   */\r\n  gracePeriodInSec = 600;\r\n\r\n  validateSignature(params: ValidationParams, retry = false): Promise<any> {\r\n    if (!params.idToken) throw new Error('Parameter idToken expected!');\r\n    if (!params.idTokenHeader)\r\n      throw new Error('Parameter idTokenHandler expected.');\r\n    if (!params.jwks) throw new Error('Parameter jwks expected!');\r\n\r\n    if (\r\n      !params.jwks['keys'] ||\r\n      !Array.isArray(params.jwks['keys']) ||\r\n      params.jwks['keys'].length === 0\r\n    ) {\r\n      throw new Error('Array keys in jwks missing!');\r\n    }\r\n\r\n    // console.debug('validateSignature: retry', retry);\r\n\r\n    let kid: string = params.idTokenHeader['kid'];\r\n    let keys: object[] = params.jwks['keys'];\r\n    let key: object;\r\n\r\n    let alg = params.idTokenHeader['alg'];\r\n\r\n    if (kid) {\r\n      key = keys.find(k => k['kid'] === kid /* && k['use'] === 'sig' */);\r\n    } else {\r\n      let kty = this.alg2kty(alg);\r\n      let matchingKeys = keys.filter(\r\n        k => k['kty'] === kty && k['use'] === 'sig'\r\n      );\r\n\r\n      /*\r\n            if (matchingKeys.length == 0) {\r\n                let error = 'No matching key found.';\r\n                console.error(error);\r\n                return Promise.reject(error);\r\n            }*/\r\n      if (matchingKeys.length > 1) {\r\n        let error =\r\n          'More than one matching key found. Please specify a kid in the id_token header.';\r\n        console.error(error);\r\n        return Promise.reject(error);\r\n      } else if (matchingKeys.length === 1) {\r\n        key = matchingKeys[0];\r\n      }\r\n    }\r\n\r\n    if (!key && !retry && params.loadKeys) {\r\n      return params\r\n        .loadKeys()\r\n        .then(loadedKeys => (params.jwks = loadedKeys))\r\n        .then(_ => this.validateSignature(params, true));\r\n    }\r\n\r\n    if (!key && retry && !kid) {\r\n      let error = 'No matching key found.';\r\n      console.error(error);\r\n      return Promise.reject(error);\r\n    }\r\n\r\n    if (!key && retry && kid) {\r\n      let error =\r\n        'expected key not found in property jwks. ' +\r\n        'This property is most likely loaded with the ' +\r\n        'discovery document. ' +\r\n        'Expected key id (kid): ' +\r\n        kid;\r\n\r\n      console.error(error);\r\n      return Promise.reject(error);\r\n    }\r\n\r\n    let keyObj = rs.KEYUTIL.getKey(key);\r\n    let validationOptions = {\r\n      alg: this.allowedAlgorithms,\r\n      gracePeriod: this.gracePeriodInSec\r\n    };\r\n    let isValid = rs.KJUR.jws.JWS.verifyJWT(\r\n      params.idToken,\r\n      keyObj,\r\n      validationOptions\r\n    );\r\n\r\n    if (isValid) {\r\n      return Promise.resolve();\r\n    } else {\r\n      return Promise.reject('Signature not valid');\r\n    }\r\n  }\r\n\r\n  private alg2kty(alg: string) {\r\n    switch (alg.charAt(0)) {\r\n      case 'R':\r\n        return 'RSA';\r\n      case 'E':\r\n        return 'EC';\r\n      default:\r\n        throw new Error('Cannot infer kty from alg: ' + alg);\r\n    }\r\n  }\r\n\r\n  calcHash(valueToHash: string, algorithm: string): string {\r\n    let hashAlg = new rs.KJUR.crypto.MessageDigest({ alg: algorithm });\r\n    let result = hashAlg.digestString(valueToHash);\r\n    let byteArrayAsString = this.toByteArrayAsString(result);\r\n    return byteArrayAsString;\r\n  }\r\n\r\n  toByteArrayAsString(hexString: string) {\r\n    let result = '';\r\n    for (let i = 0; i < hexString.length; i += 2) {\r\n      let hexDigit = hexString.charAt(i) + hexString.charAt(i + 1);\r\n      let num = parseInt(hexDigit, 16);\r\n      result += String.fromCharCode(num);\r\n    }\r\n    return result;\r\n  }\r\n}\r\n","import { InjectionToken } from '@angular/core';\r\nimport { AuthConfig } from './auth.config';\r\n\r\nexport const AUTH_CONFIG = new InjectionToken<AuthConfig>('AUTH_CONFIG');\r\n"]}