<div class="container">
  <!-- <div class="top">
      <div class="header-row">
          <div class="title">
              <h1>Wildfires Map</h1>
              <h2 class="wildfire-count">
                  <span class='material-icons-outlined fire-icon'>local_fire_department</span>
                  {{ activeFireCount | async }} Active Wildfires
              </h2>
          </div>

        <div class="search-row">
            <div class="search-bar">
                <input type="text" placeholder="Search by Location" aria-label="Search" matInput [formControl]="searchByLocationControl" [matAutocomplete]="auto" class="search-location">
                <button matSuffix mat-icon-button aria-label="Clear" class="input-clear-button" (click)="clearSearchLocationControl()">
                    <mat-icon>close</mat-icon>
                </button>
                <mat-autocomplete class="location-results" #auto="matAutocomplete" (optionSelected)="onLocationSelected($event.option.value)">
                    <mat-option class="location-mat-option" *ngFor="let option of filteredOptions"
                        [value]="option">
                        <div class="location-option" #locationOptions [attr.data-loc-long]="option.loc[1]" [attr.data-loc-lat]="option.loc[0]">
                            <div *ngIf="option.address !== ''">
                                <div>
                                    <span class="address">{{option.address}}</span>
                                </div>
                                <div class="locality">{{option.localityName}} ({{option.localityType}})</div>
                            </div>
                            <div *ngIf="option.address === ''">
                                <div>
                                    <span class="address">{{option.localityName}}</span> <span> ({{option.localityType}})</span>
                                </div>
                            </div>
                        </div>
                    </mat-option>
                </mat-autocomplete>
            </div>
            <div class="my-location-button">
                <button mat-raised-button (click)="useMyCurrentLocation()">
                    <mat-icon class="location-icon">my_location</mat-icon>
                    Find My Location
                </button>
            </div>
            <div class="my-location-button-min">
              <button mat-icon-button (click)="useMyCurrentLocation()"><mat-icon class="location-icon">my_location</mat-icon></button>
            </div>
        </div>

        <div>
            <button mat-button [matMenuTriggerFor]="menu" class="disclaimer-dropdown">{{disclaimerText()}}<mat-icon>expand_more</mat-icon></button>
            <mat-menu #menu="matMenu">
                <button mat-menu-item (click)="openLink('Disclaimer')">
                    Disclaimer
                </button>
                <button mat-menu-item (click)="openLink('Privacy')">
                    Privacy
                </button>
                <button mat-menu-item (click)="openLink('Copyright')">
                    Copyright
                </button>
            </mat-menu>
        </div>
    </div>
      <div class="divider">
          <span>MAP LAYERS</span>
      </div>

      <div class="map-layers">
          <div matTooltip="Wildfires" class="item" [class.active]="selectedLayer === 'wildfire-stage-of-control'"
              (click)="onSelectLayer( 'wildfire-stage-of-control' )">
              <span class='material-icons-outlined icon'>local_fire_department</span>
              <span class="hide shrink">Wildfires</span>
          </div>

          <div matTooltip="Evacuation Orders and Alerts" class="item" [class.active]="selectedLayer === 'evacuation-orders-and-alerts'"
              (click)="onSelectLayer( 'evacuation-orders-and-alerts' )">
              <wf-icon class="icon" iconName="error" iconSize="small"></wf-icon>
              <span class="hide shrink">Evacuation Orders and Alerts</span>
          </div>

          <div matTooltip="Area Restrictions" class="item"
              [class.active]="selectedLayer === 'area-restrictions'"
              (click)="onSelectLayer( 'area-restrictions' )"
          >
              <span class="icon signpost mat-icon"></span>
              <span class="hide shrink">Area Restrictions</span>
          </div>

          <div matTooltip="Bans and Prohibitions" class="item" [class.active]="selectedLayer === 'bans-and-prohibitions'"
              (click)="onSelectLayer( 'bans-and-prohibitions' )">
              <wf-icon class="icon" iconName="block" iconSize="small"></wf-icon>
              <span class="hide shrink">Bans and Prohibitions</span>
          </div>

          <div matTooltip="Smoke Forecast" class="item" [class.active]="selectedLayer === 'smoke-forecast'"
              (click)="onSelectLayer( 'smoke-forecast' )">
              <wf-icon class="icon" iconName="air" iconSize="small"></wf-icon>
              <span class="hide shrink">Smoke Forecast</span>
          </div>

          <div matTooltip="Danger Rating" class="item" [class.active]="selectedLayer === 'fire-danger'" (click)="onSelectLayer( 'fire-danger' )">
              <wf-icon class="icon" iconName="format_list_numbered" iconSize="small"></wf-icon>
              <span class="hide shrink">Danger Rating</span>
          </div>

          <div matTooltip="Local Authorities" class="item" [class.active]="selectedLayer === 'local-authorities'"
              (click)="onSelectLayer( 'local-authorities' )">
              <wf-icon class="icon" iconName="place" iconSize="small"></wf-icon>
              <span class="hide shrink">Local Authorities</span>
          </div>

          <div matTooltip="Road Conditions" class="item" [class.active]="selectedLayer === 'routes-impacted'"
              (click)="onSelectLayer( 'routes-impacted' )">
              <wf-icon class="icon" iconName="directions_car_filled" iconSize="small"></wf-icon>
              <span class="hide shrink">Road Conditions</span>
          </div>
      </div>
  </div> -->

  <div class="bottom">
      <div id="panel-details" [ngClass]="showAccordion ? 'details' : 'details close'">
          <panel-wildfire-stage-of-control-container-desktop *ngIf="selectedPanel === 'wildfire-stage-of-control'"></panel-wildfire-stage-of-control-container-desktop>
          <panel-evacuation-orders-and-alerts *ngIf="selectedPanel === 'evacuation-orders-and-alerts'"></panel-evacuation-orders-and-alerts>
          <panel-area-restrictions *ngIf="selectedPanel === 'area-restrictions'"></panel-area-restrictions>
          <panel-bans-prohibitions *ngIf="selectedPanel === 'bans-and-prohibitions'"></panel-bans-prohibitions>
          <panel-smoke-forecast *ngIf="selectedPanel === 'smoke-forecast'"></panel-smoke-forecast>
          <panel-fire-danger *ngIf="selectedPanel === 'fire-danger'"></panel-fire-danger>
          <panel-road-conditions *ngIf="selectedPanel === 'routes-impacted'"></panel-road-conditions>
          <panel-local-authority *ngIf="selectedPanel === 'local-authorities'"></panel-local-authority>
      </div>
      <div class="map">
        <div class="identify-panel"></div>
        <div class="mobile-wildfire-count">
          <span style="margin: auto; display: flex;"><span class='material-icons-outlined fire-icon'>local_fire_department</span>{{ activeFireCount | async }} Active Wildfires</span>
        </div>
        <wf-map-container class="map-container" [mapConfig]="mapConfig" (mapInitialized)="initMap($event)" (toggleAccordion)="onToggleAccordion()" (selectIncidents)="onSelectIncidents($event)"></wf-map-container>
        <button mat-fab class="mat-white-48 bottom-20 right-20" (click)="useMyCurrentLocation()">
            <mat-icon svgIcon="location-enabled" *ngIf="isLocationEnabled"></mat-icon>
            <mat-icon svgIcon="location-disabled" *ngIf="!isLocationEnabled"></mat-icon>
        </button>
      </div>
      <div #resizeBox id="draggable-panel" class="draggable-panel" cdkDragLockAxis="y" (cdkDragMoved)="dragMove($event)" (cdkDragEnded)="dragDropped($event)" cdkDrag *ngIf="showPanel && incidentRefs && incidentRefs.length">

        <div class="panel-container" style="padding-top: 10px;" cdkDragHandle>
            <div class="draggable-panel-title">
                {{incidentRefs.length}} Results <mat-icon svgIcon="cancel" (click)="closePanel()"></mat-icon>
            </div>
            <div *ngIf="filteredWildfires && filteredWildfires.length">
                <div class="criteria-title">Wildfires</div>
                <div *ngFor="let wildfire of filteredWildfires" class="widget-card">
                    <div class="widget-row">
                        <div class="left-content">
                            <img *ngIf="wildfire.layerId === 'active-wildfires-fire-of-note'" class="incident-icon" height="20" width="20" src="/assets/images/local_fire_department.png" alt="local_fire_department">
                            <span class="circle-icon {{wildfire.layerId}}"></span>
                            {{wildfire.properties.incident_name ? wildfire.properties.incident_name : wildfire.properties.incident_number_label + ' Wildfire'}}
                        </div>
                        <div class="right-content">
                            <mat-icon svgIcon='arrow'></mat-icon>
                        </div>
                    </div>
                </div>
            </div>

            <div *ngIf="filteredFirePerimeters && filteredFirePerimeters.length">
                <div class="criteria-title">Fire Perimeters</div>
                <div *ngFor="let firePerimeter of filteredFirePerimeters" class="widget-card">
                    <div class="widget-row">
                        <div class="left-content">
                           {{firePerimeter.title}}
                        </div>
                        <div class="right-content">
                            <mat-icon svgIcon='arrow'></mat-icon>
                        </div>
                    </div>
                </div>
            </div>

            <div *ngIf="filteredEvacs && filteredEvacs.length">
                <div class="criteria-title">Evacuations</div>
                <div *ngFor="let evac of filteredEvacs" class="widget-card">
                    <div class="widget-row">
                        <div class="left-content">
                            <img *ngIf="evac.properties.ORDER_ALERT_STATUS === 'Alert'" class="incident-icon" height="20" width="20" src="/assets/images/svg-icons/evacuation-alert.svg" alt="Order">
                            <img *ngIf="evac.properties.ORDER_ALERT_STATUS === 'Order'" class="incident-icon" height="20" width="20" src="/assets/images/svg-icons/evacuation-order.svg" alt="Order">

                           Evacuation {{evac.properties.ORDER_ALERT_STATUS}} for {{evac.properties.ORDER_ALERT_NAME}}
                        </div>
                        <div class="right-content">
                            <mat-icon svgIcon='arrow'></mat-icon>
                        </div>
                    </div>
                </div>
            </div>

            <div *ngIf="filteredAreaRestrictions && filteredAreaRestrictions.length">
                <div class="criteria-title">Area Restrictions</div>
                <div *ngFor="let areaRestriction of filteredAreaRestrictions" class="widget-card">
                    <div class="widget-row">
                        <div class="left-content">
                            <mat-icon class="incident-icon" svgIcon="area-restriction" alt="Area Restrictions"></mat-icon>
                           {{areaRestriction.properties.NAME}}
                        </div>
                        <div class="right-content">
                            <mat-icon svgIcon='arrow'></mat-icon>
                        </div>
                    </div>
                </div>
            </div>

            <div *ngIf="filteredBansAndProhibitions && filteredBansAndProhibitions.length">
                <div class="criteria-title">Fire Bans and Prohibitions</div>
                <div *ngFor="let ban of filteredBansAndProhibitions" class="widget-card">
                    <div class="widget-row">
                        <div class="left-content">
                            <mat-icon class="incident-icon" svgIcon="ban" alt="Ban"></mat-icon>
                           Fire Ban on {{ban.title}}
                        </div>
                        <div class="right-content">
                            <mat-icon svgIcon='arrow'></mat-icon>
                        </div>
                    </div>
                </div>
            </div>

            <div *ngIf="filteredDangerRatings && filteredDangerRatings.length">
                <div class="criteria-title">Fire Danger Rating</div>
                <div *ngFor="let danger of filteredDangerRatings" class="widget-card">
                    <div class="widget-row">
                        <div class="left-content">
                            <div *ngIf = "danger.properties.DANGER_RATING_DESC === 'Extreme'">
                                <mat-icon class="incident-icon" svgIcon="fire-danger-extreme" alt="Fire Danger"></mat-icon>
                                {{danger.properties.DANGER_RATING_DESC}} Fire Danger
                            </div>
                            <div *ngIf = "danger.properties.DANGER_RATING_DESC === 'High'">
                                <mat-icon class="incident-icon" svgIcon="fire-danger-high" alt="Fire Danger"></mat-icon>
                                {{danger.properties.DANGER_RATING_DESC}} Fire Danger
                            </div>
                            <div *ngIf = "danger.properties.DANGER_RATING_DESC === 'Moderate'">
                                <mat-icon class="incident-icon" svgIcon="fire-danger-moderate" alt="Fire Danger"></mat-icon>
                                {{danger.properties.DANGER_RATING_DESC}} Fire Danger
                            </div>
                            <div *ngIf = "danger.properties.DANGER_RATING_DESC === 'Low'">
                                <mat-icon class="incident-icon" svgIcon="fire-danger-low" alt="Fire Danger"></mat-icon>
                                {{danger.properties.DANGER_RATING_DESC}} Fire Danger
                            </div>
                            <div *ngIf = "danger.properties.DANGER_RATING_DESC === 'Very Low'">
                                <mat-icon class="incident-icon" svgIcon="fire-danger-very-low" alt="Fire Danger"></mat-icon>
                                {{danger.properties.DANGER_RATING_DESC}} Fire Danger
                            </div>
                        </div>
                        <div class="right-content">
                            <mat-icon svgIcon='arrow'></mat-icon>
                        </div>
                    </div>
                </div>
            </div>

            <div *ngIf="filteredRoadEvents && filteredRoadEvents.length">
                <div class="criteria-title">Road Events</div>
                <div *ngFor="let event of filteredRoadEvents" class="widget-card">
                    <div class="widget-row">
                        <div class="left-content">
                            <mat-icon class="incident-icon" svgIcon="road-event" alt="Ban"></mat-icon>
                            {{event.title}}
                        </div>
                        <div class="right-content">
                            <mat-icon svgIcon='arrow'></mat-icon>
                        </div>
                    </div>
                </div>
            </div>

            <div *ngIf="filteredClosedRecreationSites && filteredClosedRecreationSites.length">
                <div class="criteria-title">Closed Recreation Sites</div>
                <div *ngFor="let closedRecreationSite of filteredClosedRecreationSites" class="widget-card">
                    <div class="widget-row">
                        <div class="left-content">
                            <mat-icon class="incident-icon" svgIcon="closed-recreation-site" alt="closed-recreation-site"></mat-icon>
                            {{closedRecreationSite.title}}
                        </div>
                        <div class="right-content">
                            <mat-icon svgIcon='arrow'></mat-icon>
                        </div>
                    </div>
                </div>
            </div>

            <div *ngIf="filteredForestServiceRoads && filteredForestServiceRoads.length">
                <div class="criteria-title">Forest Service Roads</div>
                <div *ngFor="let forestServiceRoad of filteredForestServiceRoads" class="widget-card">
                    <div class="widget-row">
                        <div class="left-content">
                            {{forestServiceRoad.title}}
                        </div>
                        <div class="right-content">
                            <mat-icon svgIcon='arrow'></mat-icon>
                        </div>
                    </div>
                </div>
            </div>

            <div *ngIf="filteredProtectedLandsAccessRestrictions && filteredProtectedLandsAccessRestrictions.length">
                <div class="criteria-title">Protected Lands Access Restrictions</div>
                <div *ngFor="let protectedLandsAccessRestriction of filteredProtectedLandsAccessRestrictions" class="widget-card">
                    <div class="widget-row">
                        <div class="left-content">
                            {{protectedLandsAccessRestriction.title}}
                        </div>
                        <div class="right-content">
                            <mat-icon svgIcon='arrow'></mat-icon>
                        </div>
                    </div>
                </div>
            </div>

            <div *ngIf="filteredRegionalDistricts && filteredRegionalDistricts.length">
                <div class="criteria-title">Regional Districts</div>
                <div *ngFor="let regionalDistrict of filteredRegionalDistricts" class="widget-card">
                    <div class="widget-row">
                        <div class="left-content">
                            <mat-icon class="incident-icon" svgIcon="regional-districts" alt="regional-districts"></mat-icon>
                            {{regionalDistrict.title}}
                        </div>
                        <div class="right-content">
                            <mat-icon svgIcon='arrow'></mat-icon>
                        </div>
                    </div>
                </div>
            </div>

            <div *ngIf="filteredMunicipalities && filteredMunicipalities.length">
                <div class="criteria-title">Municipalities</div>
                <div *ngFor="let municipality of filteredMunicipalities" class="widget-card">
                    <div class="widget-row">
                        <div class="left-content">
                            <mat-icon class="incident-icon" svgIcon="regional-districts" alt="municipalities"></mat-icon>
                            {{municipality.title}}
                        </div>
                        <div class="right-content">
                            <mat-icon svgIcon='arrow'></mat-icon>
                        </div>
                    </div>
                </div>
            </div>

            <div *ngIf="filteredFirstNationsTreatyLand && filteredFirstNationsTreatyLand.length">
                <div class="criteria-title">First Nations Treaty Land</div>
                <div *ngFor="let firstNationsTreatyLand of filteredFirstNationsTreatyLand" class="widget-card">
                    <div class="widget-row">
                        <div class="left-content">
                            <mat-icon class="incident-icon" svgIcon="brown-square" alt="first-nations-treaty-land"></mat-icon>
                            {{firstNationsTreatyLand.title}}
                        </div>
                        <div class="right-content">
                            <mat-icon svgIcon='arrow'></mat-icon>
                        </div>
                    </div>
                </div>
            </div>

            <div *ngIf="filteredIndianReserve && filteredIndianReserve.length">
                <div class="criteria-title">Indian Reserve</div>
                <div *ngFor="let indianReserve of filteredIndianReserve" class="widget-card">
                    <div class="widget-row">
                        <div class="left-content">
                            <mat-icon class="incident-icon" svgIcon="indian-reserve" alt="indian-reserve"></mat-icon>
                            {{indianReserve.title}}
                        </div>
                        <div class="right-content">
                            <mat-icon svgIcon='arrow'></mat-icon>
                        </div>
                    </div>
                </div>
            </div>
        </div>
      </div>
  </div>
</div>
