<mat-tab-group mat-stretch-tabs="false" mat-align-tabs="center" [(selectedIndex)]="tabIndex" (selectedTabChange)="onTabChanged($event);">
        <mat-tab label="Legend">
          <section>
            <!-- Show the selected feature layer on the top -->
            <wfnews-fire-legend *ngIf="selectedPanel === 'wildfire-stage-of-control' && checkLayerVisible(['active-wildfires-fire-of-note', 'active-wildfires-out-of-control', 'active-wildfires-holding', 'active-wildfires-under-control', 'active-wildfires-out', 'fire-perimeters'])"></wfnews-fire-legend>
            <wfnews-evac-legend *ngIf="selectedPanel === 'evacuation-orders-and-alerts' && checkLayerVisible('evacuation-orders-and-alerts-wms')"></wfnews-evac-legend>
            <wfnews-bans-legend *ngIf="selectedPanel === 'bans-and-prohibitions' && checkLayerVisible(['bans-and-prohibitions-cat1', 'bans-and-prohibitions-cat2', 'bans-and-prohibitions-cat3'])"></wfnews-bans-legend>
            <wfnews-area-restriction-legend *ngIf="selectedPanel === 'area-restrictions' && checkLayerVisible('area-restrictions')"></wfnews-area-restriction-legend>
            <wfnews-danger-rating-legend *ngIf="selectedPanel === 'fire-danger' && checkLayerVisible('danger-rating')"></wfnews-danger-rating-legend>
            <wfnews-smoke-legend *ngIf="selectedPanel === 'smoke-forecast' && checkLayerVisible('hourly-currentforecast-firesmoke')"></wfnews-smoke-legend>
            <wfnews-road-event-legend *ngIf="selectedPanel === 'routes-impacted' && checkLayerVisible('drive-bc-active-events')"></wfnews-road-event-legend>
            <wfnews-local-authorities-legend *ngIf="selectedPanel === 'local-authorities' && checkLayerVisible(['abms-municipalities', 'abms-regional-districts', 'clab-indian-reserves', 'fnt-treaty-land'])"></wfnews-local-authorities-legend>
            <!-- Show the rest below -->
            <wfnews-fire-legend *ngIf="selectedPanel !== 'wildfire-stage-of-control' && checkLayerVisible(['active-wildfires-fire-of-note', 'active-wildfires-out-of-control', 'active-wildfires-holding', 'active-wildfires-under-control', 'active-wildfires-out', 'fire-perimeters'])"></wfnews-fire-legend>
            <wfnews-evac-legend *ngIf="selectedPanel !== 'evacuation-orders-and-alerts' && checkLayerVisible('evacuation-orders-and-alerts-wms')"></wfnews-evac-legend>
            <wfnews-bans-legend *ngIf="selectedPanel !== 'bans-and-prohibitions' && checkLayerVisible(['bans-and-prohibitions-cat1', 'bans-and-prohibitions-cat2', 'bans-and-prohibitions-cat3'])"></wfnews-bans-legend>
            <wfnews-area-restriction-legend *ngIf="selectedPanel !== 'area-restrictions' && checkLayerVisible('area-restrictions')"></wfnews-area-restriction-legend>
            <wfnews-danger-rating-legend *ngIf="selectedPanel !== 'fire-danger' && checkLayerVisible('danger-rating')"></wfnews-danger-rating-legend>
            <wfnews-smoke-legend *ngIf="selectedPanel !== 'smoke-forecast' && checkLayerVisible('hourly-currentforecast-firesmoke')"></wfnews-smoke-legend>
            <wfnews-road-event-legend *ngIf="selectedPanel !== 'routes-impacted' && checkLayerVisible('drive-bc-active-events')"></wfnews-road-event-legend>
            <wfnews-local-authorities-legend *ngIf="selectedPanel !== 'local-authorities' && checkLayerVisible(['abms-municipalities', 'abms-regional-districts', 'clab-indian-reserves', 'fnt-treaty-land'])"></wfnews-local-authorities-legend>
            <!-- All other layers appear below the feature layers -->
            <wfnews-map-legend *ngIf="checkLayerVisible('bc-fire-centres')"></wfnews-map-legend>
            <wfnews-precip-radar-legend *ngIf="checkLayerVisible('radar-1km-rrai--radarurpprecipr14-linear')"></wfnews-precip-radar-legend>
            <wfnews-precip-forecast-legend *ngIf="checkLayerVisible('precipitation')"></wfnews-precip-forecast-legend>
            <wfnews-rec-site-legend *ngIf="checkLayerVisible('closed-recreation-sites')"></wfnews-rec-site-legend>
            <wfnews-protected-lands-legend *ngIf="checkLayerVisible('protected-lands-access-restrictions')"></wfnews-protected-lands-legend>
          </section>
          <section>
            <h1>More Information</h1>
            <article *ngIf="selectedPanel === 'wildfire-stage-of-control'" (click)="openlink('https://www2.gov.bc.ca/gov/content/safety/wildfire-status/wildfire-response/management-strategies/stages-of-control')"><div class="link-container"><span>Wildfire Stages of Control</span><img alt="link" class="icon" src="/assets/images/svg-icons/link.svg" ></div></article>
            <article *ngIf="selectedPanel === 'wildfire-stage-of-control'" (click)="openlink('https://www2.gov.bc.ca/gov/content/safety/wildfire-status/wildfire-response/plan-prepare-stay-informed')"><div class="link-container"><span>Plan, Prepare, Stay Informed</span><img alt="link" class="icon" src="/assets/images/svg-icons/link.svg" ></div></article>
            <article *ngIf="selectedPanel === 'evacuation-orders-and-alerts'" (click)="openlink('https://www.emergencyinfobc.gov.bc.ca/')"><div class="link-container"><span>Current Evacuation Advisory Information</span><img alt="link" class="icon" src="/assets/images/svg-icons/link.svg" ></div></article>
            <article *ngIf="selectedPanel === 'evacuation-orders-and-alerts'" (click)="openlink('https://www2.gov.bc.ca/gov/content/safety/emergency-management/preparedbc/evacuation-recovery/evacuee-guidance')"><div class="link-container"><span>Evacuee Guidance</span><img alt="link" class="icon" src="/assets/images/svg-icons/link.svg" ></div></article>
            <article *ngIf="selectedPanel === 'evacuation-orders-and-alerts'" (click)="openlink('https://www2.gov.bc.ca/gov/content/governments/local-governments/facts-framework/systems')"><div class="link-container"><span>Local Government System in B.C</span><img alt="link" class="icon" src="/assets/images/svg-icons/link.svg" ></div></article>
            <article *ngIf="selectedPanel === 'evacuation-orders-and-alerts'" (click)="openlink('https://www2.gov.bc.ca/gov/content/safety/emergency-management/preparedbc/evacuation-recovery/emergency-alerts')"><div class="link-container"><span>B.C. Emergency Alerts</span><img alt="link" class="icon" src="/assets/images/svg-icons/link.svg" ></div></article>
            <article *ngIf="selectedPanel === 'area-restrictions'" (click)="openlink('https://www2.gov.bc.ca/gov/content/safety/wildfire-status/fire-bans-and-restrictions')"><div class="link-container"><span>Current Restrictions Information</span><img alt="link" class="icon" src="/assets/images/svg-icons/link.svg" ></div></article>
            <article *ngIf="selectedPanel === 'area-restrictions'" (click)="openlink('http://www.sitesandtrailsbc.ca/closures.aspx')"><div class="link-container"><span>Recreation Sites and Trails Closures</span><img alt="link" class="icon" src="/assets/images/svg-icons/link.svg" ></div></article>
            <article *ngIf="selectedPanel === 'area-restrictions'" (click)="openlink('https://bcparks.ca/wildfire/')"><div class="link-container"><span>BC Parks Closures</span><img alt="link" class="icon" src="/assets/images/svg-icons/link.svg"></div></article>
            <article *ngIf="selectedPanel === 'bans-and-prohibitions'" (click)="openlink('https://www2.gov.bc.ca/gov/content/safety/wildfire-status/fire-bans-and-restrictions')"><div class="link-container"><span >Current Fire Bans and Restrictions</span><img alt="link" class="icon" src="/assets/images/svg-icons/link.svg"></div></article>
            <article *ngIf="selectedPanel === 'bans-and-prohibitions'" (click)="openlink('https://www2.gov.bc.ca/gov/content/safety/wildfire-status/fire-bans-and-restrictions/forest-use-restrictions')"><div class="link-container"><span>Learn more about Forest Use Restrictions</span><img alt="link" class="icon" src="/assets/images/svg-icons/link.svg"></div></article>
            <article *ngIf="selectedPanel === 'bans-and-prohibitions'" (click)="openlink('https://www2.gov.bc.ca/gov/content/safety/wildfire-status/fire-bans-and-restrictions/open-burning')"><div class="link-container"><span>Learn more about Open Burning</span><img alt="link" class="icon" src="/assets/images/svg-icons/link.svg"></div></article>
            <article *ngIf="selectedPanel === 'smoke-forecast'" (click)="openlink('https://www2.gov.bc.ca/gov/content/environment/air-land-water/air/air-quality/aqhi')"><div class="link-container"><span>BC Air Quality Health Index</span><img alt="link" class="icon" src="/assets/images/svg-icons/link.svg"></div></article>
            <article *ngIf="selectedPanel === 'smoke-forecast'" (click)="openlink('https://firesmoke.ca/forecasts/')"><div class="link-container"><span>Smoke Forecast Map</span><img alt="link" class="icon" src="/assets/images/svg-icons/link.svg"></div></article>
            <article *ngIf="selectedPanel === 'smoke-forecast'" (click)="openlink('https://www2.gov.bc.ca/gov/content/safety/wildfire-status/wildfire-situation/air-quality')"><div class="link-container"><span>Wildfires and Air Quality</span><img alt="link" class="icon" src="/assets/images/svg-icons/link.svg"></div></article>
            <article *ngIf="selectedPanel === 'fire-danger'" (click)="openlink('https://www2.gov.bc.ca/gov/content/safety/wildfire-status/wildfire-situation/fire-danger')"><div class="link-container"><span>Learn more about Fire Danger Rating</span><img alt="link" class="icon" src="/assets/images/svg-icons/link.svg"></div></article>
            <article *ngIf="selectedPanel === 'routes-impacted'" (click)="openlink('https://www.drivebc.ca/#mapView&ll=53.461646%2C-119.621042&z=6')"><div class="link-container"><span>Drive BC Road Conditions</span><img alt="link" class="icon" src="/assets/images/svg-icons/link.svg"></div></article>
            <article *ngIf="selectedPanel === 'routes-impacted'" (click)="openlink('https://www2.gov.bc.ca/gov/content/industry/natural-resource-use/resource-roads/local-road-safety-information')"><div class="link-container"><span>Resource Road Safety Information</span><img alt="link" class="icon" src="/assets/images/svg-icons/link.svg"></div></article>
            <article *ngIf="selectedPanel === 'routes-impacted'" (click)="openlink('https://www.tranbc.ca/current-travel-advisories/')"><div class="link-container"><span>TranBC: Current Road Advisories and Information</span><img alt="link" class="icon" src="/assets/images/svg-icons/link.svg"></div></article>
            <article *ngIf="selectedPanel === 'local-authorities'" (click)="openlink('https://www.emergencyinfobc.gov.bc.ca/')"><div class="link-container"><span>Current Evacuation Advisory Information</span><img alt="link" class="icon" src="/assets/images/svg-icons/link.svg"></div></article>
            <article *ngIf="selectedPanel === 'local-authorities'" (click)="openlink('https://www2.gov.bc.ca/gov/content/safety/emergency-management/preparedbc/evacuation-recovery/evacuee-guidance')"><div class="link-container"><span>Evacuee Guidance</span><img alt="link" class="icon" src="/assets/images/svg-icons/link.svg"></div></article>
            <article *ngIf="selectedPanel === 'local-authorities'" (click)="openlink('https://www2.gov.bc.ca/gov/content/governments/local-governments/facts-framework/systems')"><div class="link-container"><span>Local Government System in B.C</span><img alt="link" class="icon" src="/assets/images/svg-icons/link.svg"></div></article>
            <article *ngIf="selectedPanel === 'local-authorities'" (click)="openlink('https://www2.gov.bc.ca/gov/content/safety/emergency-management/preparedbc/evacuation-recovery/emergency-alerts')"><div class="link-container"><span>B.C. Emergency Alerts</span><img alt="link" class="icon" src="/assets/images/svg-icons/link.svg"></div></article>
        </section>
    </mat-tab>
    <mat-tab label="List">
      <div *ngIf="selectedPanel === 'evacuation-orders-and-alerts'">
        <div class="current-list">
          <h3>Evacuation Orders and Alerts</h3>
          <div *ngIf="evacOrders.length === 0" class="paragraph-format">There are no current Evacuation Orders or Alerts</div>
          <div class="evac-list-box">
            <div class="evac-card-holder">
              <div *ngFor="let evac of evacOrders; let i = index">
                <div [class]="(i % 2 === 0 ? 'blue-background ' : '') + 'evac-card'" (mouseup)="zoomToEvac(evac)">
                  <div class="evac-card-content">
                    <img *ngIf="evac.orderAlertStatus === 'Order'" height="22" width="22" src="/assets/images/svg-icons/evacuation-order.svg" alt="Order" />
                    <img *ngIf="evac.orderAlertStatus === 'Alert'" height="22" width="22" src="/assets/images/svg-icons/evacuation-alert.svg" alt="Alert" />
                    <span class="evac-card-title">{{evac.eventName}}</span>
                  </div>
                  <div class="evac-card-content">
                    <img height="22" width="22" src="/assets/images/svg-icons/calendar-pin.svg" alt="updated on" />
                    <span class="evac-card-text">Updated on {{evac.issuedOn}}</span>
                  </div>
                  <div class="evac-card-content">
                    <img height="22" width="22" src="/assets/images/svg-icons/local_authority.svg" alt="issued by" />
                    <span class="evac-card-text">Issued by {{evac.issuingAgency}}</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div *ngIf="selectedPanel === 'area-restrictions'">
        <div class="current-list">
          <h3>Area Restrictions</h3>
          <article>
            <div class="restriction-list" *ngFor="let area of areaRestrictions">
              <div class="label" (mouseup)="zoomToArea(area)">{{area.name}}</div>
              <div *ngIf="area.bulletinUrl" style="margin-left: auto;"><a (click)="snowplow('area_restriction_outbound_click', area.bulletinUrl)" [href]="area.bulletinUrl"><mat-icon>link</mat-icon></a></div>
            </div>
            <div *ngIf="areaRestrictions.length === 0" class="paragraph-format">There are no current Area Restrictions</div>
          </article>
        </div>
      </div>
      <div *ngIf="selectedPanel !== 'evacuation-orders-and-alerts' && selectedPanel !== 'area-restrictions'">
        <div class="wildfire-list-toggle-title" style="display:flex">
            <div style="width: 80%">Choose Wildfires to display</div>
            <div>{{collection? collection.totalRowCount: 0}} Results</div>
        </div>
        <div class="wildfire-checkboxs">
            <div class="row">
              <mat-checkbox aria-label="active" (change)="stageOfControlChanges($event)" [(ngModel)]="activeWildfiresInd">Active Wildfires</mat-checkbox>
              <mat-checkbox aria-label="new" (change)="stageOfControlChanges($event)" [(ngModel)]="newFires">New Wildfires</mat-checkbox>
            </div>
            <div class="row">
              <mat-checkbox aria-label="out" (change)="stageOfControlChanges($event)" [(ngModel)]="outWildfiresInd">Out Wildfires</mat-checkbox>
              <mat-checkbox aria-label="fire-of-note" (change)="stageOfControlChanges($event)" [(ngModel)]="wildfiresOfNoteInd">Wildfires of Note</mat-checkbox>
            </div>
        </div>
        <div *ngIf="loading">
          <mat-spinner style="margin: auto;" *ngIf="!loaded" [diameter]="50"></mat-spinner>
        </div>
        <div *ngIf="!loading">
          <div *ngIf="collectionData">
            <div class = "incident-item" *ngFor="let incident of collectionData" (click)="openPreview(incident)" (mouseenter)="onPanelMouseEnter(incident)" (mouseleave)="onPanelMouseExit(incident)">
              <mat-progress-bar [id]="incident.incidentName" mode="determinate" [value]="progressValues.get(incident.incidentName)"></mat-progress-bar>
              <div class="item-header" style="color: #1a5a96">{{incident.incidentName}}
                <span #el style="cursor: pointer;" (click)="onWatchlist(incident) ? removeFromWatchlist(incident) : addToWatchlist(incident)" (click)="onClickBookmark($event)">
                    <mat-icon style="color:#1A5A96; vertical-align: middle;">{{onWatchlist(incident) ? 'bookmark' : 'bookmark_border'}}</mat-icon>
                </span>
                </div>
                <div class="item-row">
                    <span class="item-title">Last Updated: </span>
                    <span class="item-content">{{convertToDateWithDayOfWeek(incident.lastUpdatedTimestamp)}}</span>
                </div>
                <div class="item-row">
                    <span class="item-title">Fire Centre: </span>
                    <span class="item-content">{{convertToFireCentreDescription(incident.fireCentreName || incident.fireCentre || incident.fireCentreCode)}}</span>
                </div>
                <div class="item-row">
                    <span class="item-title">Distance from My Location: </span>
                    <span class="item-content">{{calculateDistance(Number(incident.latitude), Number(incident.longitude))}} km</span>
                </div>
                <div class="tags">
                    <span *ngIf="incident.fireOfNoteInd" class="wildifire-of-note-tag">
                        <span class='material-icons-outlined fire-icon' style="vertical-align:middle">local_fire_department</span>
                        Wildfire of Note
                    </span>
                    <span class="stage-of-control-status-indicator {{incident.stageOfControlCode}}">
                        <span class="circle-icon {{incident.stageOfControlCode}}"></span>
                        {{convertToStageOfControlDescription(incident.stageOfControlCode)}}
                    </span>
                </div>
            </div>
        </div>
        <div class="bottom-summary flex-y-fixed">
          <div class="showing-summary" style="flex: 75%;">{{summaryString}}</div>
          <span class="paging-control {{isFirstPage}}" (click)="onPageChange(-1)"><mat-icon>chevron_left</mat-icon>Back</span>
          <span class="paging-control {{isLastPage}}" (click)="onPageChange(0)">Next<mat-icon>chevron_right</mat-icon></span>
        </div>
      </div>
      </div>
    </mat-tab>
</mat-tab-group>
<ng-template #listIdentifyContainer></ng-template>
<ng-template #wildfirePanelContainer></ng-template>
