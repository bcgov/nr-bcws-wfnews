FROM apache/apisix
EXPOSE 2379 8080 9080 9443
ENV ALLOW_NONE_AUTHENTICATION=yes ETCD_ADVERTISE_CLIENT_URLS=http://127.0.0.1:2379
COPY docker/apisix.yaml /usr/local/apisix/conf/apisix.yaml
USER root
RUN apt-get update &&\
  apt-get install -y nginx &&\
  apt-get install etcd &&\
  sed -i '/#!\/usr\/bin\/env bash/#!\/usr\/bin\/env bash\nnginx&\netcd&/' /docker-entrypoint.sh
COPY docker/default.conf /etc/nginx/conf.d/default.conf